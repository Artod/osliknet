var __decorate=this&&this.__decorate||function(decorators,target,key,desc){var d,c=arguments.length,r=3>c?target:null===desc?desc=Object.getOwnPropertyDescriptor(target,key):desc;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(decorators,target,key,desc);else for(var i=decorators.length-1;i>=0;i--)(d=decorators[i])&&(r=(3>c?d(r):c>3?d(target,key,r):d(target,key))||r);return c>3&&r&&Object.defineProperty(target,key,r),r},__metadata=this&&this.__metadata||function(k,v){return"object"==typeof Reflect&&"function"==typeof Reflect.metadata?Reflect.metadata(k,v):void 0},__param=this&&this.__param||function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}},__extends=this&&this.__extends||function(d,b){function __(){this.constructor=d}for(var p in b)b.hasOwnProperty(p)&&(d[p]=b[p]);d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)};System.register("services/trip/trip.service",["angular2/core","angular2/http"],function(exports_1,context_1){"use strict";var core_1,http_1,TripService;context_1&&context_1.id;return{setters:[function(core_1_1){core_1=core_1_1},function(http_1_1){http_1=http_1_1}],execute:function(){TripService=function(){function TripService(http){this.http=http}return TripService.prototype.search=function(data,limit,lastId){var headers=new http_1.Headers;headers.append("X-Requested-With","XMLHttpRequest");var search=new http_1.URLSearchParams;return data.from_id&&search.set("from_id",data.from_id),data.to_id&&search.set("to_id",data.to_id),limit&&search.set("limit",limit),lastId&&search.set("lastId",lastId),this.http.get("/trips?xhr",{headers:headers,search:search}).map(function(res){return res.json()})},TripService.prototype.getMy=function(limit,page){var headers=new http_1.Headers;headers.append("X-Requested-With","XMLHttpRequest");var search=new http_1.URLSearchParams;return limit&&search.set("limit",limit),page&&search.set("page",page),this.http.get("/trips/my?xhr",{headers:headers,search:search}).map(function(res){return res.json()})},TripService.prototype.getById=function(id){var headers=new http_1.Headers;return headers.append("X-Requested-With","XMLHttpRequest"),this.http.get("/trips/"+id+"?xhr",{headers:headers}).map(function(res){return res.json()})},TripService.prototype.addTrips=function(data){var headers=new http_1.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/trips/add?xhr",JSON.stringify(data),{headers:headers}).map(function(res){return res.json()})},TripService.prototype.update=function(data){var headers=new http_1.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/trips/update?xhr",JSON.stringify(data),{headers:headers}).map(function(res){return res.json()})},TripService=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.Http])],TripService)}(),exports_1("TripService",TripService)}}}),System.register("services/order/order.service",["angular2/core","angular2/http"],function(exports_2,context_2){"use strict";var core_2,http_2,OrderService;context_2&&context_2.id;return{setters:[function(core_2_1){core_2=core_2_1},function(http_2_1){http_2=http_2_1}],execute:function(){OrderService=function(){function OrderService(http){this.http=http}return OrderService.prototype.get=function(limit,page){var headers=new http_2.Headers;headers.append("X-Requested-With","XMLHttpRequest");var search=new http_2.URLSearchParams;return limit&&search.set("limit",limit),page&&search.set("page",page),this.http.get("/orders?xhr",{headers:headers,search:search}).map(function(res){return res.json()})},OrderService.prototype.getByTripId=function(tripId){var headers=new http_2.Headers;return headers.append("X-Requested-With","XMLHttpRequest"),this.http.get("/orders/trip/"+tripId+"?xhr",{headers:headers}).map(function(res){return res.json()})},OrderService.prototype.add=function(data){var headers=new http_2.Headers;return headers.append("X-Requested-With","XMLHttpRequest"),headers.append("Content-Type","application/json"),this.http.post("/orders/add?xhr",JSON.stringify(data),{headers:headers}).map(function(res){return res.json()})},OrderService.prototype.changeStatus=function(status,order){var headers=new http_2.Headers;headers.append("X-Requested-With","XMLHttpRequest"),headers.append("Content-Type","application/json");var data={status:status,order:order};return this.http.post("/orders/status?xhr",JSON.stringify(data),{headers:headers}).map(function(res){return res.json()})},OrderService=__decorate([core_2.Injectable(),__metadata("design:paramtypes",[http_2.Http])],OrderService)}(),exports_2("OrderService",OrderService)}}}),System.register("services/subscribe/subscribe.service",["angular2/core","angular2/http"],function(exports_3,context_3){"use strict";var core_3,http_3,SubscribeService;context_3&&context_3.id;return{setters:[function(core_3_1){core_3=core_3_1},function(http_3_1){http_3=http_3_1}],execute:function(){SubscribeService=function(){function SubscribeService(http){this.http=http}return SubscribeService.prototype.add=function(data){var headers=new http_3.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/subscribes/add?xhr",JSON.stringify(data),{headers:headers}).map(function(res){return res.json()})},SubscribeService.prototype.cancel=function(id){var headers=new http_3.Headers;return headers.append("X-Requested-With","XMLHttpRequest"),this.http.get("/subscribes/cancel/"+id+"?xhr",{headers:headers}).map(function(res){return res.json()})},SubscribeService=__decorate([core_3.Injectable(),__metadata("design:paramtypes",[http_3.Http])],SubscribeService)}(),exports_3("SubscribeService",SubscribeService)}}}),System.register("services/modal/modal.component",["angular2/core"],function(exports_4,context_4){"use strict";var core_4,ModalComponent;context_4&&context_4.id;return{setters:[function(core_4_1){core_4=core_4_1}],execute:function(){ModalComponent=function(){function ModalComponent(){this.loaded=!1,this.bodyOpenClass="modal-open",this.splashOpenClass="splash-open",this.$body=window.document.querySelector("body")}return ModalComponent.prototype.ngAfterContentInit=function(){var _this=this;setTimeout(function(){return _this.show()},0)},ModalComponent.prototype.show=function(){this.$splash=this._ref.location.nativeElement.querySelector(".splash"),this.$splash.classList.add(this.splashOpenClass),this.$body.classList.add(this.bodyOpenClass)},ModalComponent.prototype.close=function($event){var _this=this;return this.$splash.classList.remove(this.splashOpenClass),this.$body.classList.remove(this.bodyOpenClass),setTimeout(function(){_this._ref.dispose()},500),this.prevent($event),!1},ModalComponent.prototype.prevent=function($event){$event&&$event.stopPropagation()},ModalComponent=__decorate([core_4.Component({selector:"modal",template:'\n		<section class="splash">\n			<div class="splash-inner">\n				<div class="container" (click)="prevent($event)">\n					<button class="close text-right" type="button" (click)="close($event)"><span class="glyphicon glyphicon-remove-circle"></span></button>\n					<comp #comp [hidden]="loaded" style="text-center">Loading...</comp>			\n				</div>\n			</div>\n		</section>'}),__metadata("design:paramtypes",[])],ModalComponent)}(),exports_4("ModalComponent",ModalComponent)}}}),System.register("services/modal/modal.service",["angular2/core","services/modal/modal.component"],function(exports_5,context_5){"use strict";var core_5,modal_component_1,ModalService;context_5&&context_5.id;return{setters:[function(core_5_1){core_5=core_5_1},function(modal_component_1_1){modal_component_1=modal_component_1_1}],execute:function(){ModalService=function(){function ModalService(_componentLoader,_appRef){this._componentLoader=_componentLoader,this._appRef=_appRef}return ModalService.prototype.show=function(Component,providers){var _this=this,promise=this.open().then(function(modalComponentRef){return _this.bind(Component,modalComponentRef,providers).then(function(componentRef){return modalComponentRef.instance})});return promise},ModalService.prototype.open=function(){var elementRef=this._appRef._rootComponents[0].location,promise=this._componentLoader.loadNextToLocation(modal_component_1.ModalComponent,elementRef);return promise.then(function(modalComponentRef){return modalComponentRef.instance._ref=modalComponentRef,modalComponentRef}),promise},ModalService.prototype.bind=function(Component,modalComponentRef,providers){var elementRef=modalComponentRef.location,promise=this._componentLoader.loadIntoLocation(Component,elementRef,"comp",providers).then(function(componentRef){return componentRef.instance._modalComponent=modalComponentRef.instance,modalComponentRef.instance.loaded=!0,componentRef});return promise},ModalService=__decorate([core_5.Injectable(),__metadata("design:paramtypes",[core_5.DynamicComponentLoader,core_5.ApplicationRef])],ModalService)}(),exports_5("ModalService",ModalService)}}}),System.register("services/notification/notification.service",["angular2/core","angular2/http","rxjs/Observable","rxjs/Subject"],function(exports_6,context_6){"use strict";var core_6,http_4,Observable_1,Subject_1,NotificationService;context_6&&context_6.id;return{setters:[function(core_6_1){core_6=core_6_1},function(http_4_1){http_4=http_4_1},function(Observable_1_1){Observable_1=Observable_1_1},function(Subject_1_1){Subject_1=Subject_1_1}],execute:function(){NotificationService=function(){function NotificationService(http){this.http=http,this.data={},this.updated=0,this._defaultTimeout=1e4,this._headers=new http_4.Headers,this._headers.append("X-Requested-With","XMLHttpRequest"),this.subject=new Subject_1.Subject}return NotificationService.prototype.changeTimeout=function(timeout){this.start(timeout)},NotificationService.prototype.start=function(timeout){var _this=this;return timeout=timeout||this._defaultTimeout,timeout===this.currentTimeout&&this._pollSub&&!this._pollSub.isUnsubscribed?this.subject:(this.currentTimeout=timeout,this.stop(),this._pollSub=Observable_1.Observable.timer(0,this.currentTimeout).switchMap(function(){return _this.http.get("/users/notifications/"+_this.updated,{headers:_this._headers})}).map(function(res){return res.json()}).subscribe(function(res){var serverUpdated=new Date(res.updated_at).getTime();serverUpdated!==_this.updated&&(console.log("New notification!"),_this.updated=serverUpdated,_this.data=res||{},_this.subject.next(_this.data))},function(err){}),this.subject)},NotificationService.prototype.stop=function(){this._pollSub&&!this._pollSub.isUnsubscribed&&this._pollSub.unsubscribe()},NotificationService=__decorate([core_6.Injectable(),__metadata("design:paramtypes",[http_4.Http])],NotificationService)}(),exports_6("NotificationService",NotificationService)}}}),System.register("pipes/to-date.pipe",["angular2/core"],function(exports_7,context_7){"use strict";var core_7,ToDatePipe;context_7&&context_7.id;return{setters:[function(core_7_1){core_7=core_7_1}],execute:function(){ToDatePipe=function(){function ToDatePipe(){}return ToDatePipe.prototype.transform=function(value,args){return new Date(value)},ToDatePipe=__decorate([core_7.Pipe({name:"toDate",pure:!1}),__metadata("design:paramtypes",[])],ToDatePipe)}(),exports_7("ToDatePipe",ToDatePipe)}}}),System.register("components/user-card.component",["angular2/core","angular2/router","pipes/to-date.pipe"],function(exports_8,context_8){"use strict";var core_8,router_1,to_date_pipe_1,UserCardComponent;context_8&&context_8.id;return{setters:[function(core_8_1){core_8=core_8_1},function(router_1_1){router_1=router_1_1},function(to_date_pipe_1_1){to_date_pipe_1=to_date_pipe_1_1}],execute:function(){UserCardComponent=function(){function UserCardComponent(configUser){this.configUser=configUser}return __decorate([core_8.Input(),__metadata("design:type",Object)],UserCardComponent.prototype,"user",void 0),UserCardComponent=__decorate([core_8.Component({selector:"user-card",template:'\n   <span *ngIf="user && user.name" class="user-card">\n   	<a *ngIf="(configUser && configUser.id)" [routerLink]="[\'User\', {id: (user._id || user.id)}]" class="avatar">\n   		<img src="http://gravatar.com/avatar/{{ user.gravatar_hash }}?d=monsterid&s=40" alt="" />\n   		<span class="user-name">{{ user.name }}</span>\n   	</a>\n	\n   	<a *ngIf="!(configUser && configUser.id)" [routerLink]="[\'Join\']" class="avatar">\n   		<img src="http://gravatar.com/avatar/{{ user.gravatar_hash }}?d=monsterid&s=40" alt="" />\n   		<span class="user-name">{{ user.name }}</span>\n   	</a>\n   </span>\n	',directives:[router_1.ROUTER_DIRECTIVES],pipes:[to_date_pipe_1.ToDatePipe]}),__param(0,core_8.Inject("config.user")),__metadata("design:paramtypes",[Object])],UserCardComponent)}(),exports_8("UserCardComponent",UserCardComponent)}}}),System.register("components/trip-card.component",["angular2/core","angular2/router","components/user-card.component","pipes/to-date.pipe"],function(exports_9,context_9){"use strict";var core_9,router_2,user_card_component_1,to_date_pipe_2,TripCardComponent;context_9&&context_9.id;return{setters:[function(core_9_1){core_9=core_9_1},function(router_2_1){router_2=router_2_1},function(user_card_component_1_1){user_card_component_1=user_card_component_1_1},function(to_date_pipe_2_1){to_date_pipe_2=to_date_pipe_2_1}],execute:function(){TripCardComponent=function(){function TripCardComponent(){}return __decorate([core_9.Input(),__metadata("design:type",Object)],TripCardComponent.prototype,"trip",void 0),__decorate([core_9.Input(),__metadata("design:type",Object)],TripCardComponent.prototype,"user",void 0),TripCardComponent=__decorate([core_9.Component({selector:"trip-card",template:'\n   <div class="trip-card">\n   	<p class="trip-from-to">\n   		<a href="#" [routerLink]="[\'Trip\', {id: trip._id}]">\n   			{{ trip.from }}\n   			<span class="glyphicon glyphicon-arrow-right"></span>\n   			{{ trip.to }}\n   		</a>\n   	</p>\n\n   	<p>\n   		<span class="text-muted small1">{{ trip.when | toDate | date: \'longDate\' }}</span>\n   	</p>\n\n   	<user-card [user]="user" *ngIf="user && user._id"></user-card>\n   </div>\n	',directives:[router_2.ROUTER_DIRECTIVES,user_card_component_1.UserCardComponent],pipes:[to_date_pipe_2.ToDatePipe]}),__metadata("design:paramtypes",[])],TripCardComponent)}(),exports_9("TripCardComponent",TripCardComponent)}}}),System.register("components/order-card.component",["angular2/core","angular2/router","components/user-card.component","pipes/to-date.pipe"],function(exports_10,context_10){"use strict";var core_10,router_3,user_card_component_2,to_date_pipe_3,OrderCardComponent;context_10&&context_10.id;return{setters:[function(core_10_1){core_10=core_10_1},function(router_3_1){router_3=router_3_1},function(user_card_component_2_1){user_card_component_2=user_card_component_2_1},function(to_date_pipe_3_1){to_date_pipe_3=to_date_pipe_3_1}],execute:function(){OrderCardComponent=function(){function OrderCardComponent(configOrderStatus){this.configOrderStatus=configOrderStatus}return __decorate([core_10.Input(),__metadata("design:type",Object)],OrderCardComponent.prototype,"order",void 0),__decorate([core_10.Input(),__metadata("design:type",Object)],OrderCardComponent.prototype,"user",void 0),OrderCardComponent=__decorate([core_10.Component({selector:"order-card",template:'\n   <div class="order-card">\n   	<user-card [user]="user" *ngIf="user && user._id"></user-card>\n\n   	<p class="order-info">\n   		<span class="text-muted">{{ order.created_at | toDate | date: \'longDate\' }} | \n   		Order status: <b>{{ configOrderStatus[order.status] }}</b></span>\n   	</p>\n   </div>\n	',directives:[router_3.ROUTER_DIRECTIVES,user_card_component_2.UserCardComponent],pipes:[to_date_pipe_3.ToDatePipe]}),__param(0,core_10.Inject("config.orderStatus")),__metadata("design:paramtypes",[Object])],OrderCardComponent)}(),exports_10("OrderCardComponent",OrderCardComponent)}}}),System.register("components/goto-card.component",["angular2/core","angular2/router"],function(exports_11,context_11){"use strict";var core_11,router_4,GotoComponent;context_11&&context_11.id;return{setters:[function(core_11_1){core_11=core_11_1},function(router_4_1){router_4=router_4_1}],execute:function(){GotoComponent=function(){function GotoComponent(){this.order={},this.newMessages={}}return __decorate([core_11.Input(),__metadata("design:type",Object)],GotoComponent.prototype,"order",void 0),__decorate([core_11.Input(),__metadata("design:type",Object)],GotoComponent.prototype,"newMessages",void 0),GotoComponent=__decorate([core_11.Component({selector:"goto",template:'\n   <div class="text-right">\n   	<span *ngIf="newMessages && newMessages[order._id] && newMessages[order._id][0]" class="label label-danger">{{newMessages[order._id][0]}} new</span>\n	\n   	<a [routerLink]="[\'Order\', {id:order._id}]">\n   		Go to negotiation\n   		<span *ngIf="order.msg_cnt">({{ order.msg_cnt }})</span>\n   		<!-- <span class="badge" *ngIf="newMessages[order._id] && newMessages[order._id][0]">{{newMessages[order._id][0]}}</span> -->					\n   	</a>\n   </div>\n	',directives:[router_4.ROUTER_DIRECTIVES]}),__metadata("design:paramtypes",[])],GotoComponent)}(),exports_11("GotoComponent",GotoComponent)}}}),System.register("components/order-add.component",["angular2/core","angular2/common","angular2/router","services/order/order.service","pipes/to-date.pipe"],function(exports_12,context_12){"use strict";var core_12,common_1,router_5,order_service_1,to_date_pipe_4,OrderAddComponent;context_12&&context_12.id;return{setters:[function(core_12_1){core_12=core_12_1},function(common_1_1){common_1=common_1_1},function(router_5_1){router_5=router_5_1},function(order_service_1_1){order_service_1=order_service_1_1},function(to_date_pipe_4_1){to_date_pipe_4=to_date_pipe_4_1}],execute:function(){OrderAddComponent=function(){function OrderAddComponent(_orderService,_router,_location,_fb,trip,configUser){var _this=this;this._orderService=_orderService,this._router=_router,this._location=_location,this._fb=_fb,this.trip=trip,this.configUser=configUser,this.model={},this.order={},this._checked=!1,this._busy=!1,this.error="",this.form=_fb.group({trip:["",common_1.Validators.required],message:["",common_1.Validators.required]}),this.model.trip=trip._id,this._orderService.getByTripId(trip._id).subscribe(function(data){_this.order=data.order||{},_this._checked=!0},function(err){_this._checked=!0}),this._locationSubscribe=this._location.subscribe(function(){_this.closeModal()}),this.showModal()}return OrderAddComponent.prototype.ngOnDestroy=function(){this._locationSubscribe.unsubscribe()},OrderAddComponent.prototype.showModal=function(){this._modalComponent&&this._modalComponent.show()},OrderAddComponent.prototype.closeModal=function(){this._modalComponent&&this._modalComponent.close()},OrderAddComponent.prototype.onSubmit=function($textarea){var _this=this;return this.form.controls.message.valid?void(this.form.valid&&!this._busy&&(this._busy=!0,this.error="",this._orderService.add(this.model).subscribe(function(data){_this.error="",_this.order=data.order||{},_this.order&&_this.order._id&&(_this._router.navigate(["Order",{id:_this.order._id}]),_this.closeModal()),_this._busy=!1},function(err){_this.error="Unexpected error. Try again later.";try{_this.error=err.json().error||_this.error}catch(e){}_this._busy=!1}))):void $textarea.focus()},OrderAddComponent=__decorate([core_12.Component({template:'\n   <div (window:keydown)="$event.keyCode == 27 ? closeModal() : true">\n   	<div *ngIf="!_checked">\n   		<div class="page-header">\n   			<h2> </h2>\n   		</div>\n		\n   		Loading...\n   	</div>\n	\n   	<div *ngIf="!(configUser && configUser.id)">\n   		<div class="page-header">\n   			<h2>Request for delivery</h2>\n   		</div>\n   		<p>\n   			You are not authorized. <a [routerLink]="[\'Join\']" (click)="closeModal()">Create An Account</a> or <a [routerLink]="[\'Login\']" (click)="closeModal()">Log in</a> to an existing.\n   		</p>\n   	</div>\n\n   	<div *ngIf="_checked && order && order._id">\n   		<div class="page-header">\n   			<h2> </h2>\n   		</div>\n		\n   		<p>\n   			<span class="text-muted">{{ order.created_at | toDate | date: \'longDate\' }}</span>\n   		</p>	\n		\n   		<p class="order-message">\n   			{{ order.message }}\n   		</p>\n		\n   		<div class="text-right">\n   			<a [routerLink]="[\'Order\', {id: order._id}]" (click)="closeModal()">Go to negotiation <span *ngIf="order.msg_cnt">({{ order.msg_cnt }})</span> </a>\n   		</div>\n   	</div>\n\n   	<div *ngIf="(configUser && configUser.id) && _checked && (!order || !order._id)">\n   		<div class="page-header">\n   			<h2>Add a Request for delivery</h2>\n   		</div>\n\n   		<form action="/orders/add" method="post" [ngFormModel]="form" (submit)="_busy ? false : onSubmit(textarea)">\n   			<input type="hidden" name="trip" value="" [(ngModel)]="model.trip" [ngFormControl]="form.controls.trip" />\n\n   			<div class="form-group">	\n   				<textarea class="form-control" name="message" [(ngModel)]="model.message" [ngFormControl]="form.controls.message" placeholder="Description" maxlength="2000" #textarea></textarea>\n   			</div>\n			\n   			<br />\n			\n   			<p class="text-right">\n   				<button type="button" class="btn btn-default btn-lg" (click)="closeModal()" [disabled]="_busy">Cancel</button>\n   				<button type="submit" class="btn btn-warning btn-lg">{{ _busy ? \'Wait...\' : \'Send\' }}</button>\n   			</p>\n			\n   			<div *ngIf="error" class="help-block text-right {{error ? \'has-error\' : \'\'}}">\n   				{{ error }}\n   			</div>\n   		</form>\n   	</div>\n   </div>\n	',directives:[router_5.ROUTER_DIRECTIVES],providers:[common_1.FormBuilder],pipes:[to_date_pipe_4.ToDatePipe]}),__param(3,core_12.Inject(common_1.FormBuilder)),__param(4,core_12.Inject("trip")),__param(5,core_12.Inject("config.user")),__metadata("design:paramtypes",[order_service_1.OrderService,router_5.Router,router_5.Location,common_1.FormBuilder,Object,Object])],OrderAddComponent)}(),exports_12("OrderAddComponent",OrderAddComponent)}}}),System.register("components/trip.component",["angular2/core","angular2/common","angular2/router","services/trip/trip.service","services/order/order.service","services/subscribe/subscribe.service","services/modal/modal.service","services/notification/notification.service","components/trip-card.component","components/order-card.component","components/goto-card.component","components/order-add.component","pipes/to-date.pipe"],function(exports_13,context_13){"use strict";var core_13,common_2,router_6,trip_service_1,order_service_2,subscribe_service_1,modal_service_1,notification_service_1,trip_card_component_1,order_card_component_1,goto_card_component_1,order_add_component_1,to_date_pipe_5,TripComponent;context_13&&context_13.id;return{setters:[function(core_13_1){core_13=core_13_1},function(common_2_1){common_2=common_2_1},function(router_6_1){router_6=router_6_1},function(trip_service_1_1){trip_service_1=trip_service_1_1},function(order_service_2_1){order_service_2=order_service_2_1},function(subscribe_service_1_1){subscribe_service_1=subscribe_service_1_1},function(modal_service_1_1){modal_service_1=modal_service_1_1},function(notification_service_1_1){notification_service_1=notification_service_1_1},function(trip_card_component_1_1){trip_card_component_1=trip_card_component_1_1},function(order_card_component_1_1){order_card_component_1=order_card_component_1_1},function(goto_card_component_1_1){goto_card_component_1=goto_card_component_1_1},function(order_add_component_1_1){order_add_component_1=order_add_component_1_1},function(to_date_pipe_5_1){to_date_pipe_5=to_date_pipe_5_1}],execute:function(){TripComponent=function(){function TripComponent(_router,_location,_modalService,_notificationService,_orderService,_tripService,_subscribeService,_routeParams,_fb,_appRef,configUser){var _this=this;this._router=_router,this._location=_location,this._modalService=_modalService,this._notificationService=_notificationService,this._orderService=_orderService,this._tripService=_tripService,this._subscribeService=_subscribeService,this._routeParams=_routeParams,this._fb=_fb,this._appRef=_appRef,this.configUser=configUser,this.tripId="",this.trip={},this.subscribe={},this.orders=[],this.model={},this.newMessages={},this._inited=!1,this._busy=!1,this.editMode=!1,this.tripId=this._routeParams.get("id"),this.form=this._fb.group({id:["",common_2.Validators.required],description:["",common_2.Validators.required]}),this.model.id=this.tripId,this._tripService.getById(this.tripId).subscribe(function(res){_this.trip=res.trip||{},_this.orders=res.orders||[],_this.subscribe=res.subscribe||{},_this.trip&&(_this.model.description=_this.trip.description||""),_this._inited=!0},function(error){_this._inited=!0}),this.newMessages=this._notificationService.data.newMessages||{},this._notifSub=this._notificationService.start().subscribe(function(data){_this.newMessages=data.newMessages||{},_this._appRef.tick()})}return TripComponent.prototype.ngOnDestroy=function(){this._notifSub.unsubscribe()},TripComponent.prototype.onSubmit=function($textarea){var _this=this;return this.form.controls.description.valid?void(this.form.valid&&!this._busy&&(this._busy=!0,this._tripService.update(this.model).subscribe(function(data){data.trip&&(_this.trip.description=data.trip.description),_this._busy=!1,_this.editMode=!1},function(err){_this._busy=!1,_this.editMode=!1}))):void $textarea.focus()},TripComponent.prototype.onRequest=function(trip){var _this=this;this._modalService.open().then(function(modalComponentRef){var otherResolved=core_13.Injector.resolve([core_13.provide(order_service_2.OrderService,{useValue:_this._orderService}),core_13.provide(router_6.Router,{useValue:_this._router}),core_13.provide(router_6.Location,{useValue:_this._location}),core_13.provide("trip",{useValue:trip})]);_this._modalService.bind(order_add_component_1.OrderAddComponent,modalComponentRef,otherResolved)})},TripComponent.prototype.unsubscribe=function($link){return this._subscribeService.cancel(this.subscribe._id).subscribe(function(data){$link.innerHTML="<i>You have successfully unsubscribed!</i>"},function(err){$link.innerHTML="<i>Something went wrong. Try again later.</i>"}),!1},TripComponent=__decorate([core_13.Component({template:'\n   <div class="container">\n   	<div class="page-header">\n   		<h2>Trip</h2>\n   	</div>\n\n   	<p *ngIf="!_inited">Loading...</p>\n\n   	<div *ngIf="trip && trip.user">\n   		<p *ngIf="subscribe && subscribe._id" class="text-right" #link>\n   			<a href="#" (click)="unsubscribe(link)">Unsubscribe from notifications about new trips in this direction.</a>\n   		</p>\n		\n   		<trip-card [trip]="trip" [user]="trip.user"></trip-card>\n\n   		<br />\n\n   		<p *ngIf="!editMode" class="pre-wrap">{{ trip.description }}</p>\n		\n   		<form *ngIf="editMode" action="/trips/edit" method="post" [ngFormModel]="form" (submit)="_busy ? false : onSubmit(textarea)">\n		\n   			<input type="hidden" name="id" [(ngModel)]="model.id" [ngFormControl]="form.controls.id" />\n			\n   			<div class="form-group">\n   				<textarea class="form-control" name="description" [(ngModel)]="model.description" [ngFormControl]="form.controls.description" maxlength="2000" placeholder="Description" #textarea></textarea>\n   			</div>\n			\n   			<p class="text-right">\n   				<button type="submit" class="btn btn-warning btn-lg">{{ _busy ? \'Wait...\' : \'Update\' }}</button>\n   				<button type="submit" class="btn btn-default btn-lg" (click)="editMode = false" [disabled]="_busy">Cancel</button>\n   			</p>\n   		</form>	\n		\n   		<p *ngIf="!editMode && configUser.id === trip.user._id" class="text-right">\n   			<button class="btn btn-default btn-lg" (click)="editMode = true">Edit</button>\n   		</p>\n\n   		<p *ngIf="trip.user._id != configUser.id" class="text-right">\n   			<button class="btn btn-default btn-lg" (click)="onRequest(trip)">Request Delivery</button>\n   		</p>\n   	</div>\n\n   	<div *ngIf="trip && trip.user && configUser.id === trip.user._id">\n   		<br />\n   		<br />\n   		<h4>Requests for shipping:</h4>\n\n   		<p *ngIf="orders && !orders.length"><i>There are no requests yet.</i></p>\n\n   		<table class="table trips-my-requests">\n   			<tr *ngFor="#order of orders">\n   				<td>\n   					<order-card [order]="order" [user]="order.user"></order-card>\n					\n   					<p class="order-message">\n   						{{ order.message }}\n   					</p>\n					\n   					<goto [order]="order" [newMessages]="newMessages"></goto>\n   					<!-- <p class="text-right">\n   						<a [routerLink]="[\'Order\', {id:order._id}]">Go to negotiation <span *ngIf="order.msg_cnt">({{ order.msg_cnt }})</span> <!- <span class="badge" *ngIf="newMessages[order._id] && newMessages[order._id][0]">{{newMessages[order._id][0]}}</span> -></a>\n   					</p> -->			\n   				</td>\n   			</tr>\n   		</table>\n   	</div>\n   </div>\n	',directives:[router_6.ROUTER_DIRECTIVES,trip_card_component_1.TripCardComponent,order_card_component_1.OrderCardComponent,goto_card_component_1.GotoComponent],pipes:[to_date_pipe_5.ToDatePipe]}),__param(10,core_13.Inject("config.user")),__metadata("design:paramtypes",[router_6.Router,router_6.Location,modal_service_1.ModalService,notification_service_1.NotificationService,order_service_2.OrderService,trip_service_1.TripService,subscribe_service_1.SubscribeService,router_6.RouteParams,common_2.FormBuilder,core_13.ApplicationRef,Object])],TripComponent)}(),exports_13("TripComponent",TripComponent)}}}),System.register("components/captcha.component",["angular2/core","angular2/common"],function(exports_14,context_14){"use strict";var core_14,common_3,CaptchaComponent;context_14&&context_14.id;return{setters:[function(core_14_1){core_14=core_14_1},function(common_3_1){common_3=common_3_1}],execute:function(){CaptchaComponent=function(){function CaptchaComponent(configCaptcha,_el){this.configCaptcha=configCaptcha,this._el=_el,this.needReloadCaptchaChange=new core_14.EventEmitter,this.modelChange=new core_14.EventEmitter}return CaptchaComponent.prototype.ngOnInit=function(){var _this=this;this.interval=window.setInterval(function(){_this.checkLoaded()},100),this.checkLoaded()},CaptchaComponent.prototype.ngOnDestroy=function(){this.interval&&window.clearInterval(this.interval)},CaptchaComponent.prototype.checkLoaded=function(){this.configCaptcha.loaded&&(window.clearInterval(this.interval),this.interval=null,this.init())},CaptchaComponent.prototype.ngOnChanges=function(changes){changes.needReloadCaptcha&&!changes.needReloadCaptcha.isFirstChange()&&this.reset()},CaptchaComponent.prototype.reset=function(){window.grecaptcha.reset(this.captchaId),this.needReloadCaptcha=!1,this.needReloadCaptchaChange.emit(this.needReloadCaptcha)},CaptchaComponent.prototype.init=function(){var _this=this,$el=this._el.nativeElement.querySelector(".g-recaptcha");$el.innerHTML="",this.modelChange.emit(""),this.model="",this.captchaId=window.grecaptcha.render($el,{sitekey:this.configCaptcha.key,theme:"light",callback:function(response){_this.modelChange.emit(response),_this.model=response},"expired-callback":function(response){_this.modelChange.emit(""),_this.model=response}})},__decorate([core_14.Input(),__metadata("design:type",common_3.Control)],CaptchaComponent.prototype,"ctrl",void 0),__decorate([core_14.Input(),__metadata("design:type",Object)],CaptchaComponent.prototype,"model",void 0),__decorate([core_14.Input(),__metadata("design:type",Object)],CaptchaComponent.prototype,"needReloadCaptcha",void 0),__decorate([core_14.Output(),__metadata("design:type",core_14.EventEmitter)],CaptchaComponent.prototype,"needReloadCaptchaChange",void 0),__decorate([core_14.Output("modelChange"),__metadata("design:type",core_14.EventEmitter)],CaptchaComponent.prototype,"modelChange",void 0),
CaptchaComponent=__decorate([core_14.Component({selector:"captcha",template:'\n		<input name="recaptcha" type="hidden" [(ngModel)]="model" [ngFormControl]="ctrl" value="" />\n		<div class="g-recaptcha">Loading captcha...</div>\n	'}),__param(0,core_14.Inject("config.captcha")),__metadata("design:paramtypes",[Object,core_14.ElementRef])],CaptchaComponent)}(),exports_14("CaptchaComponent",CaptchaComponent)}}}),System.register("services/maps-api-loader/maps-api-loader",["angular2/core"],function(exports_15,context_15){"use strict";var core_15,MapsAPILoader;context_15&&context_15.id;return{setters:[function(core_15_1){core_15=core_15_1}],execute:function(){MapsAPILoader=function(){function MapsAPILoader(){}return MapsAPILoader=__decorate([core_15.Injectable(),__metadata("design:paramtypes",[])],MapsAPILoader)}(),exports_15("MapsAPILoader",MapsAPILoader)}}}),System.register("services/maps-api-loader/lazy-maps-api-loader",["angular2/core","services/maps-api-loader/maps-api-loader"],function(exports_16,context_16){"use strict";var core_16,maps_api_loader_1,GoogleMapsScriptProtocol,LazyMapsAPILoaderConfig,DEFAULT_CONFIGURATION,LazyMapsAPILoader;context_16&&context_16.id;return{setters:[function(core_16_1){core_16=core_16_1},function(maps_api_loader_1_1){maps_api_loader_1=maps_api_loader_1_1}],execute:function(){!function(GoogleMapsScriptProtocol){GoogleMapsScriptProtocol[GoogleMapsScriptProtocol.HTTP=0]="HTTP",GoogleMapsScriptProtocol[GoogleMapsScriptProtocol.HTTPS=1]="HTTPS",GoogleMapsScriptProtocol[GoogleMapsScriptProtocol.AUTO=2]="AUTO"}(GoogleMapsScriptProtocol||(GoogleMapsScriptProtocol={})),exports_16("GoogleMapsScriptProtocol",GoogleMapsScriptProtocol),LazyMapsAPILoaderConfig=function(){function LazyMapsAPILoaderConfig(){this.apiKey=null,this.apiVersion="3",this.hostAndPath="maps.googleapis.com/maps/api/js",this.protocol=GoogleMapsScriptProtocol.HTTPS,this.params=null}return LazyMapsAPILoaderConfig}(),exports_16("LazyMapsAPILoaderConfig",LazyMapsAPILoaderConfig),DEFAULT_CONFIGURATION=new LazyMapsAPILoaderConfig,LazyMapsAPILoader=function(_super){function LazyMapsAPILoader(_config){_super.call(this),this._config=_config,null!==this._config&&void 0!==this._config||(this._config=DEFAULT_CONFIGURATION)}return __extends(LazyMapsAPILoader,_super),LazyMapsAPILoader.prototype.load=function(){if(this._scriptLoadingPromise)return this._scriptLoadingPromise;var script=document.createElement("script");script.type="text/javascript",script.async=!0,script.defer=!0;var callbackName="angular2googlemaps"+(new Date).getMilliseconds();return script.src=this._getScriptSrc(callbackName),this._scriptLoadingPromise=new Promise(function(resolve,reject){window[callbackName]=function(){resolve()},script.onerror=function(error){reject(error)}}),document.body.appendChild(script),this._scriptLoadingPromise},LazyMapsAPILoader.prototype._getScriptSrc=function(callbackName){var protocol,protocolType=this._config&&this._config.protocol||DEFAULT_CONFIGURATION.protocol;switch(protocolType){case GoogleMapsScriptProtocol.AUTO:protocol="";break;case GoogleMapsScriptProtocol.HTTP:protocol="http:";break;case GoogleMapsScriptProtocol.HTTPS:protocol="https:"}var hostAndPath=this._config.hostAndPath||DEFAULT_CONFIGURATION.hostAndPath,apiKey=this._config.apiKey||DEFAULT_CONFIGURATION.apiKey,queryParams={v:this._config.apiVersion||DEFAULT_CONFIGURATION.apiKey,callback:callbackName};apiKey&&(queryParams.key=apiKey);var params=Object.keys(queryParams).map(function(k,i){var param=0===i?"?":"&";return param+=k+"="+queryParams[k]}).join(""),addParams=this._config&&this._config.params||DEFAULT_CONFIGURATION.params;return protocol+"//"+hostAndPath+params+addParams},LazyMapsAPILoader=__decorate([core_16.Injectable(),__param(0,core_16.Optional()),__metadata("design:paramtypes",[LazyMapsAPILoaderConfig])],LazyMapsAPILoader)}(maps_api_loader_1.MapsAPILoader),exports_16("LazyMapsAPILoader",LazyMapsAPILoader)}}}),System.register("components/gm-autocomplite.component",["angular2/core","services/maps-api-loader/lazy-maps-api-loader","angular2/common"],function(exports_17,context_17){"use strict";var core_17,lazy_maps_api_loader_1,common_4,GmAutocompliteComponent;context_17&&context_17.id;return{setters:[function(core_17_1){core_17=core_17_1},function(lazy_maps_api_loader_1_1){lazy_maps_api_loader_1=lazy_maps_api_loader_1_1},function(common_4_1){common_4=common_4_1}],execute:function(){GmAutocompliteComponent=function(){function GmAutocompliteComponent(_loader,_el,_zone){this._loader=_loader,this._el=_el,this._zone=_zone,this.newPlace=new core_17.EventEmitter,this.isInvalid=!1,this._currentCity=""}return GmAutocompliteComponent.prototype.ngOnInit=function(){var _this=this,$inputs=this._el.nativeElement.querySelectorAll("input"),$place=$inputs[0],$place_id=$inputs[1];this._loader.load().then(function(){_this.init($place,$place_id)}),this._currentCity=this.model[this.name_place]},GmAutocompliteComponent.prototype.init=function($place,$place_id){var autocomplete=new google.maps.places.Autocomplete($place,{types:["(cities)"]}),that=this;google.maps.event.addListener(autocomplete,"place_changed",function(){var place=this.getPlace();that._zone.run(function(){that._currentCity=$place.value,that.model[that.name_place]=that._currentCity,that.model[that.name_id]=place.place_id,that.newPlace.emit(place)})})},GmAutocompliteComponent.prototype.check=function(value){this._currentCity&&value!==this._currentCity&&(this._currentCity="",this.model[this.name_place]="",this.model[this.name_id]="")},GmAutocompliteComponent.prototype.onEnter=function($event,value){value&&value!==this._currentCity&&($event.preventDefault(),this.check())},__decorate([core_17.Input(),__metadata("design:type",String)],GmAutocompliteComponent.prototype,"name_place",void 0),__decorate([core_17.Input(),__metadata("design:type",String)],GmAutocompliteComponent.prototype,"name_id",void 0),__decorate([core_17.Input(),__metadata("design:type",String)],GmAutocompliteComponent.prototype,"class",void 0),__decorate([core_17.Input(),__metadata("design:type",String)],GmAutocompliteComponent.prototype,"placeholder",void 0),__decorate([core_17.Input(),__metadata("design:type",common_4.ControlGroup)],GmAutocompliteComponent.prototype,"form",void 0),__decorate([core_17.Input(),__metadata("design:type",Object)],GmAutocompliteComponent.prototype,"model",void 0),__decorate([core_17.Output(),__metadata("design:type",core_17.EventEmitter)],GmAutocompliteComponent.prototype,"newPlace",void 0),GmAutocompliteComponent=__decorate([core_17.Component({selector:"gm-autocomplite",template:'\n   <input placeholder="{{placeholder}}" name="{{name_place}}" type="text" class="autocomplite {{class}}" [(ngModel)]="model[name_place]" [ngFormControl]="form.controls[name_place]" (change)="check(place.value)" (keydown.enter)="onEnter($event, place.value)" #place />\n   <input name="{{name_id}}" type="hidden" [(ngModel)]="model[name_id]" [ngFormControl]="form.controls[name_id]" value="" />\n	'}),__metadata("design:paramtypes",[lazy_maps_api_loader_1.LazyMapsAPILoader,core_17.ElementRef,core_17.NgZone])],GmAutocompliteComponent)}(),exports_17("GmAutocompliteComponent",GmAutocompliteComponent)}}}),System.register("components/trips.component",["angular2/core","angular2/common","angular2/router","services/trip/trip.service","services/order/order.service","services/subscribe/subscribe.service","services/modal/modal.service","components/captcha.component","components/trip-card.component","components/gm-autocomplite.component","components/order-add.component","pipes/to-date.pipe"],function(exports_18,context_18){"use strict";var core_18,common_5,router_7,trip_service_2,order_service_3,subscribe_service_2,modal_service_2,captcha_component_1,trip_card_component_2,gm_autocomplite_component_1,order_add_component_2,to_date_pipe_6,TripsComponent;context_18&&context_18.id;return{setters:[function(core_18_1){core_18=core_18_1},function(common_5_1){common_5=common_5_1},function(router_7_1){router_7=router_7_1},function(trip_service_2_1){trip_service_2=trip_service_2_1},function(order_service_3_1){order_service_3=order_service_3_1},function(subscribe_service_2_1){subscribe_service_2=subscribe_service_2_1},function(modal_service_2_1){modal_service_2=modal_service_2_1},function(captcha_component_1_1){captcha_component_1=captcha_component_1_1},function(trip_card_component_2_1){trip_card_component_2=trip_card_component_2_1},function(gm_autocomplite_component_1_1){gm_autocomplite_component_1=gm_autocomplite_component_1_1},function(order_add_component_2_1){order_add_component_2=order_add_component_2_1},function(to_date_pipe_6_1){to_date_pipe_6=to_date_pipe_6_1}],execute:function(){TripsComponent=function(){function TripsComponent(_router,_location,_modalService,_orderService,_tripService,_subscribeService,_fb,_routeParams,_routeData,_el,_appRef,configUser){var _this=this;this._router=_router,this._location=_location,this._modalService=_modalService,this._orderService=_orderService,this._tripService=_tripService,this._subscribeService=_subscribeService,this._fb=_fb,this._routeParams=_routeParams,this._routeData=_routeData,this._el=_el,this._appRef=_appRef,this.configUser=configUser,this.trips=[],this.subscribe={},this.searchModel={},this.subModel={},this.lastId="",this.limit=15,this._busy=!1,this._inited=!1,this._busySearch=!1,this._subBusy=!1,this._subsFinished=!1,this._subSubmitted=!1,this.isMain=this._routeData.get("isMain"),this.searchForm=this._fb.group({from:"",from_id:"",to:"",to_id:""}),this.subModel={email:"",recaptcha:""},this.subForm=this._fb.group({email:configUser.id?"":["",common_5.Validators.compose([function(ctrl){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(ctrl.value)?null:{invalidEmail:!0}},common_5.Validators.required])],recaptcha:configUser.id?"":["",common_5.Validators.required]}),this.init(),this._locationSubscribe=this._location.subscribe(function(){_this.init()})}return TripsComponent.prototype.ngAfterViewInit=function(){},TripsComponent.prototype.ngOnDestroy=function(){this._locationSubscribe.unsubscribe()},TripsComponent.prototype.routerCanReuse=function(nextInstruction,prevInstruction){return nextInstruction.urlPath===prevInstruction.urlPath},TripsComponent.prototype.routerOnReuse=function(next,prev){this._routeParams.params=next.params},TripsComponent.prototype.init=function(){var from=this._routeParams.get("from"),to=this._routeParams.get("to");this.searchModel={from:from?decodeURIComponent(from):"",from_id:this._routeParams.get("from_id")||"",to:to?decodeURIComponent(to):"",to_id:this._routeParams.get("to_id")||""},this.search()},TripsComponent.prototype.serialize=function(obj){return"?"+Object.keys(obj).reduce(function(a,k){return obj[k]&&a.push(k+"="+encodeURIComponent(obj[k])),a},[]).join("&")},TripsComponent.prototype.loadNext=function(){var _this=this;this._busy=!0;var queryId=this.serialize(this.searchModel)+this.lastId;this._tripService.search(this.searchModel,this.limit,this.lastId).subscribe(function(data){queryId===_this.serialize(_this.searchModel)+_this.lastId&&((data.trips||[]).forEach(function(trip){_this.trips.push(trip)}),_this.subscribe=data.subscribe||{},_this.lastId=(data.trips[_this.limit-1]||{})._id||"",_this._busy=!1)},function(err){_this._busy=!1})},TripsComponent.prototype.onSubmit=function(isFromEvent,$form,$thanx){this._busySearch||this.search(isFromEvent,$form,$thanx)},TripsComponent.prototype.search=function(isFromEvent,$form,$thanx){var _this=this;if(!this.searchForm.valid)return!1;if(this.searchModel.from_id||(this.searchModel.from=""),this.searchModel.to_id||(this.searchModel.to=""),isFromEvent){if(this.isMain)return void setTimeout(function(){return _this._router.navigate(["Trips",_this.searchModel])},10);this._location.go("/trips",this.serialize(this.searchModel))}return this.subModel.from_id===this.searchModel.from_id&&this.subModel.to_id===this.searchModel.to_id||(this._subsFinished=!1),this.subModel.from=this.searchModel.from,this.subModel.from_id=this.searchModel.from_id,this.subModel.to=this.searchModel.to,this.subModel.to_id=this.searchModel.to_id,this.searchModel.from_id||this.searchModel.to_id?(this._busySearch=!0,void this._tripService.search(this.searchModel,this.limit).subscribe(function(data){_this.trips=data.trips||[],_this.lastId=(data.trips[_this.limit-1]||{})._id||"",_this.subscribe=data.subscribe||{},_this._inited=!0,_this._busySearch=!1},function(err){_this._inited=!0,_this._busySearch=!1})):(this.trips=[],this.subscribe={},void(this.lastId=""))},TripsComponent.prototype.onSubscribe=function($event,$form){var _this=this,$email=$form.querySelector('input[type="email"]');return $email&&""===$email.value?($email.focus(),!1):(this._subSubmitted=!0,this.subForm.valid?(this._subBusy=!0,void this._subscribeService.add(this.subModel).subscribe(function(data){_this._subsFinished=!0,_this._subSubmitted=!1,_this._subBusy=!1,_this._appRef.tick()},function(err){_this._subBusy=!1})):!1)},TripsComponent.prototype.onRequest=function(trip){this._modalService.show(order_add_component_2.OrderAddComponent,core_18.Injector.resolve([core_18.provide(order_service_3.OrderService,{useValue:this._orderService}),core_18.provide(router_7.Router,{useValue:this._router}),core_18.provide(router_7.Location,{useValue:this._location}),core_18.provide("trip",{useValue:trip})]))},TripsComponent.prototype.unsubscribe=function($link){var _this=this;return this._subscribeService.cancel(this.subscribe._id).subscribe(function(data){$link.innerHTML="<i>You have successfully unsubscribed!</i>",_this._subsFinished=!1},function(err){$link.innerHTML="<i>Something went wrong. Try again later.</i>"}),!1},TripsComponent=__decorate([core_18.Component({template:'\n   <div *ngIf="isMain">\n   	<video *ngIf="isMain" id="bgvid" autoplay loop muted poster="/img/342960428.jpg">\n   		<source type="video/mp4" src="/video/342960428.mp4" />\n   		<source type="video/webm" src="/video/342960428.webm" />\n   	</video>\n	\n   	<div class="video-overlay"></div>\n	\n   	<div class="promo-text white-font text-center">\n   		<p>\n   			<br />\n   			People who travel frequently can deliver anything. For example, you live in the USA and you urgently need any medication or documents from Russia. In our application, you can find someone who is just about to arrive from Moscow to New York. He can help you for money or for free.\n   			<br />\n   			<br />\n   		</p>\n   	</div>\n   </div>\n\n   <div class="container-trips-find container">\n   	<div *ngIf="!isMain" class="page-header">\n   		<h2>Find a Trip</h2>\n   	</div>\n	\n   	<h4 *ngIf="isMain" class="white-font">Find trips</h4>\n	\n   	<form class="trips-find-form form-inline" method="get" [ngFormModel]="searchForm" (submit)="onSubmit(true, form, thanx)" #searchFormEl>\n   		<div class="form-group">\n   			<gm-autocomplite [class]="\'form-control input-lg\'" [name_place]="\'from\'" [name_id]="\'from_id\'" [form]="searchForm" [(model)]="searchModel" (newPlace)="onSubmit(true, form, thanx)" placeholder="From"></gm-autocomplite>\n   		</div>\n		\n   		<div class="arrow-right form-group {{isMain ? \'white-font\' : \'\'}}">\n   			<span class="glyphicon glyphicon-arrow-right"></span>\n   		</div>\n\n   		<div class="form-group">	\n   			<gm-autocomplite [class]="\'form-control input-lg\'" [name_place]="\'to\'" [name_id]="\'to_id\'" [form]="searchForm" [(model)]="searchModel" (newPlace)="onSubmit(true, form, thanx)" placeholder="To"></gm-autocomplite>\n   		</div>\n		\n   		<div class="form-group">\n   			<button type="submit" class="btn btn-warning btn-lg">{{ _busySearch ? \'Wait\' : \'Find\' }}</button>\n   		</div>\n   	</form>\n   </div>\n\n   <br />\n   <br />\n\n   <div class="container">\n   	<table class="table">\n   		<tr *ngFor="#trip of trips">\n   			<td>\n   				<trip-card [trip]="trip" [user]="trip.user"></trip-card>\n\n   				<p>\n   					{{ trip.description }}\n   				</p>\n   				<p class="text-right" *ngIf="trip.user._id != configUser.id">\n   					<button class="btn btn-default btn-lg1" (click)="onRequest(trip)">Request a delivery</button>\n   				</p>\n   			</td>\n   		</tr>\n   	</table>\n\n   	<p *ngIf="lastId" class="text-center">\n   		<button class="btn btn-default btn-lg" (click)="_busy ? false : loadNext()">{{ _busy ? \'Wait...\' : \'Load more\' }}</button>\n   		<br />\n   		<br />\n   	</p>\n\n   	<div *ngIf="_inited && (subModel.from_id || subModel.to_id)" class="text-center">\n   		<p *ngIf="!trips || !trips.length">\n   			<i>Trips in this direction are not presented at the moment.</i>\n   		</p>\n\n   		<p *ngIf="subscribe && subscribe._id" #linkUnsubscribe>\n   			<a href="#" (click)="unsubscribe(linkUnsubscribe)">Unsubscribe from notifications about new trips in the direction.</a>\n   		</p>\n\n   		<div *ngIf="(!subscribe || !subscribe._id) && (subModel.from_id || subModel.to_id)" class="subscribe-form">		\n   			<p [hidden]="!_subsFinished" #thanx>\n   				<i>Subscribed. Thank you!</i> \n   			</p>\n\n   			<form *ngIf="!_subsFinished" method="post" [ngFormModel]="subForm" (submit)="_subBusy ? false : onSubscribe($event, form)" novalidate #form>\n   				<p>\n   					<i>We\'ll let you know when a new trip {{ subModel.from ? \'from «\' + subModel.from +\'»\' : \'\' }} {{ subModel.to ? \'to «\' + subModel.to + \'»\' : \'\' }} will appear:</i>\n					\n   					<br />\n   				</p>\n				\n   				<div class="form-group {{_subSubmitted && !subForm.controls.email.valid ? \'has-error\' : \'\'}}">\n   					<input *ngIf="!configUser.id" class="form-control subscribe-email" type="email" name="email" [(ngModel)]="subModel.email" [ngFormControl]="subForm.controls.email" placeholder="E-mail"  />		\n   				</div>\n					\n   				<div *ngIf="!configUser.id" class="form-group {{_subSubmitted && subModel.recaptcha === \'\' ? \'has-error\' : \'\'}}">\n   					<captcha [ctrl]="subForm.controls.recaptcha" [(model)]="subModel.recaptcha"></captcha>\n   				</div>\n				\n   				<div class="form-group {{configUser.id ? \'\' : \'text-right\'}}">\n   					<button type="submit" class="btn btn-warning btn-lg1">{{ _subBusy ? \'Wait...\' : \'Subscribe\' }}</button>	\n   				</div>\n\n   			</form> \n		\n   		</div>\n		\n   	</div>\n   </div>\n	',directives:[gm_autocomplite_component_1.GmAutocompliteComponent,router_7.ROUTER_DIRECTIVES,trip_card_component_2.TripCardComponent,captcha_component_1.CaptchaComponent],pipes:[to_date_pipe_6.ToDatePipe]}),__param(11,core_18.Inject("config.user")),__metadata("design:paramtypes",[router_7.Router,router_7.Location,modal_service_2.ModalService,order_service_3.OrderService,trip_service_2.TripService,subscribe_service_2.SubscribeService,common_5.FormBuilder,router_7.RouteParams,router_7.RouteData,core_18.ElementRef,core_18.ApplicationRef,Object])],TripsComponent)}(),exports_18("TripsComponent",TripsComponent)}}}),System.register("services/datepicker/interfaces",[],function(exports_19,context_19){"use strict";context_19&&context_19.id;return{setters:[],execute:function(){}}}),System.register("services/datepicker/mydatepicker",["angular2/core","angular2/common"],function(exports_20,context_20){"use strict";var core_19,common_6,MyDatePicker;context_20&&context_20.id;return{setters:[function(core_19_1){core_19=core_19_1},function(common_6_1){common_6=common_6_1}],execute:function(){MyDatePicker=function(){function MyDatePicker(elem){var _this=this;this.elem=elem,this.dateChanged=new core_19.EventEmitter,this.showSelector=!1,this.visibleMonth={monthTxt:"",monthNbr:0,year:0},this.selectedDate={year:0,month:0,day:0},this.weekDays=[],this.dates=[],this.selectionDayTxt="",this.dayIdx=0,this.today=null,this.PREV_MONTH=1,this.CURR_MONTH=2,this.NEXT_MONTH=3,this.dayLabels={su:"Sun",mo:"Mon",tu:"Tue",we:"Wed",th:"Thu",fr:"Fri",sa:"Sat"},this.monthLabels={1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"},this.dateFormat="yyyy-mm-dd",this.todayBtnTxt="Today",this.firstDayOfWeek="mo",this.sunHighlight=!0,this.height="34px",this.width="100%",this.minDate=0,this.today=new Date;var doc=document.getElementsByTagName("html")[0];doc.addEventListener("click",function(event){_this.showSelector&&event.target&&_this.elem.nativeElement!==event.target&&!_this.elem.nativeElement.contains(event.target)&&(_this.showSelector=!1)},!1)}return MyDatePicker.prototype.ngOnInit=function(){this.dayLabels=void 0!==this.options.dayLabels?this.options.dayLabels:this.dayLabels,this.monthLabels=void 0!==this.options.monthLabels?this.options.monthLabels:this.monthLabels,this.dateFormat=void 0!==this.options.dateFormat?this.options.dateFormat:this.dateFormat,this.todayBtnTxt=void 0!==this.options.todayBtnTxt?this.options.todayBtnTxt:this.todayBtnTxt,this.firstDayOfWeek=void 0!==this.options.firstDayOfWeek?this.options.firstDayOfWeek:this.firstDayOfWeek,this.sunHighlight=void 0!==this.options.sunHighlight?this.options.sunHighlight:this.sunHighlight,this.height=void 0!==this.options.height?this.options.height:this.height,this.width=void 0!==this.options.width?this.options.width:this.width,this.options.minDate&&(this.minDate=new Date(this.options.minDate.getFullYear(),this.options.minDate.getMonth(),this.options.minDate.getDate()).getTime());var days=["su","mo","tu","we","th","fr","sa"];if(this.dayIdx=days.indexOf(this.firstDayOfWeek),-1!==this.dayIdx)for(var idx=this.dayIdx,i=0;i<days.length;i++)this.weekDays.push(this.dayLabels[days[idx]]),idx="sa"===days[idx]?0:idx+1},MyDatePicker.prototype.ngOnChanges=function(changes){if(this.selectionDayTxt=changes.selDate.currentValue,""!==this.selectionDayTxt){var fmt=void 0!==this.options.dateFormat?this.options.dateFormat:this.dateFormat,dpos=fmt.indexOf("dd"),mpos=fmt.indexOf("mm"),ypos=fmt.indexOf("yyyy");this.selectedDate={day:parseInt(this.selectionDayTxt.substring(dpos,dpos+2)),month:parseInt(this.selectionDayTxt.substring(mpos,mpos+2)),year:parseInt(this.selectionDayTxt.substring(ypos,ypos+4))}}},MyDatePicker.prototype.removeBtnClicked=function(){this.selectionDayTxt="",this.selectedDate={year:0,month:0,day:0},this.dateChanged.emit({date:{},formatted:this.selectionDayTxt,epoc:0})},MyDatePicker.prototype.openBtnClicked=function(){if(this.showSelector=!this.showSelector,this.showSelector){var y=0,m=0;0===this.selectedDate.year&&0===this.selectedDate.month&&0===this.selectedDate.day?(y=this.today.getFullYear(),m=this.today.getMonth()+1):(y=this.selectedDate.year,m=this.selectedDate.month),this.visibleMonth={monthTxt:this.monthLabels[m],monthNbr:m,year:y},this.createMonth(m,y)}},MyDatePicker.prototype.prevMonth=function(){var m=this.visibleMonth.monthNbr,y=this.visibleMonth.year;1===m?(m=12,y--):m--,this.visibleMonth={monthTxt:this.monthText(m),monthNbr:m,year:y},this.createMonth(m,y)},MyDatePicker.prototype.nextMonth=function(){var m=this.visibleMonth.monthNbr,y=this.visibleMonth.year;12===m?(m=1,y++):m++,this.visibleMonth={monthTxt:this.monthText(m),monthNbr:m,year:y},this.createMonth(m,y)},MyDatePicker.prototype.prevYear=function(){this.visibleMonth.year--,this.createMonth(this.visibleMonth.monthNbr,this.visibleMonth.year)},MyDatePicker.prototype.nextYear=function(){this.visibleMonth.year++,this.createMonth(this.visibleMonth.monthNbr,this.visibleMonth.year)},MyDatePicker.prototype.todayClicked=function(){this.selectDate({day:this.today.getDate(),month:this.today.getMonth()+1,year:this.today.getFullYear()})},MyDatePicker.prototype.cellClicked=function(cell){cell.isOutOfRange||(cell.cmo===this.PREV_MONTH?(this.prevMonth(),this.selectDate(cell)):cell.cmo===this.CURR_MONTH?this.selectDate(cell):cell.cmo===this.NEXT_MONTH&&(this.nextMonth(),this.selectDate(cell)))},MyDatePicker.prototype.selectDate=function(date){this.selectedDate={day:date.day,month:date.month,year:date.year},this.selectionDayTxt=this.formatDate(date),this.showSelector=!1;var epoc=new Date(date.year,date.month-1,date.day,0,0,0,0).getTime()/1e3;this.dateChanged.emit({date:this.selectedDate,formatted:this.selectionDayTxt,epoc:epoc})},MyDatePicker.prototype.preZero=function(val){return 10>val?"0"+val:val},MyDatePicker.prototype.formatDate=function(val){return this.dateFormat.replace("yyyy",val.year).replace("mm",this.preZero(val.month)).replace("dd",this.preZero(val.day))},MyDatePicker.prototype.monthText=function(m){return this.monthLabels[m]},MyDatePicker.prototype.monthStartIdx=function(y,m){var d=new Date;d.setDate(1),d.setMonth(m-1),d.setFullYear(y);var idx=d.getDay()+this.sundayIdx();return idx>=7?idx-7:idx},MyDatePicker.prototype.daysInMonth=function(m,y){return new Date(y,m,0).getDate()},MyDatePicker.prototype.daysInPrevMonth=function(m,y){return 1===m?(m=12,y--):m--,this.daysInMonth(m,y)},MyDatePicker.prototype.isOutOfRange=function(d,m,y,cmo){var timestamp=new Date(y,m-1,d).getTime();return this.minDate&&timestamp<this.minDate},MyDatePicker.prototype.isCurrDay=function(d,m,y,cmo){return d===this.today.getDate()&&m===this.today.getMonth()+1&&y===this.today.getFullYear()&&2===cmo},MyDatePicker.prototype.sundayIdx=function(){return this.dayIdx>0?7-this.dayIdx:0},MyDatePicker.prototype.createMonth=function(m,y){this.dates.length=0;for(var monthStart=this.monthStartIdx(y,m),dInThisM=this.daysInMonth(m,y),dInPrevM=this.daysInPrevMonth(m,y),sunIdx=this.sundayIdx(),dayNbr=1,cmo=this.PREV_MONTH,i=1;7>i;i++){var week=[];if(1===i){var pm=dInPrevM-monthStart+1;m--,1>m&&(m=12,y--);for(var j=pm;dInPrevM>=j;j++)week.push({day:j,month:m,year:y,cmo:cmo,isOutOfRange:this.isOutOfRange(j,m,y),currDay:this.isCurrDay(j,m,y,cmo),sun:week.length===sunIdx});cmo=this.CURR_MONTH,m++,m>12&&(m=1,y++);for(var daysLeft=7-week.length,j=0;daysLeft>j;j++)week.push({day:dayNbr,month:m,year:y,cmo:cmo,isOutOfRange:this.isOutOfRange(dayNbr,m,y),currDay:this.isCurrDay(dayNbr,m,y,cmo),sun:week.length===sunIdx}),dayNbr++}else for(var j=1;8>j;j++)dayNbr>dInThisM&&cmo!==this.NEXT_MONTH&&(dayNbr=1,cmo=this.NEXT_MONTH,m++,m>12&&(m=1,y++)),week.push({day:dayNbr,month:m,year:y,cmo:cmo,isOutOfRange:this.isOutOfRange(dayNbr,m,y),currDay:this.isCurrDay(dayNbr,m,y,cmo),sun:week.length===sunIdx}),dayNbr++;this.dates.push(week)}},__decorate([core_19.Input(),__metadata("design:type",Object)],MyDatePicker.prototype,"options",void 0),__decorate([core_19.Input(),__metadata("design:type",String)],MyDatePicker.prototype,"selDate",void 0),__decorate([core_19.Output(),__metadata("design:type",core_19.EventEmitter)],MyDatePicker.prototype,"dateChanged",void 0),MyDatePicker=__decorate([core_19.Component({selector:"my-date-picker",template:'\n      <div class="mydp">\n      	<!-- [ngStyle]="{\'height\': height, \'width\': width}" -->\n      	<div class="input-group">\n      		<input readonly class="form-control input-lg" type="text" value="{{selectionDayTxt}}" (focus)="showSelector ? false : openBtnClicked()" placeholder="Date" />\n		\n      		<div class="input-group-btn">\n      			<button type="button" class="btn btn-default input-lg" *ngIf="selectionDayTxt.length>0" (click)="removeBtnClicked()">\n      				<span class="glyphicon glyphicon-remove"></span>\n      			</button>\n      			<button type="button" class="btn btn-default input-lg" (click)="openBtnClicked()">\n      				<span class="glyphicon glyphicon-calendar"></span>\n      			</button>\n      		</div>		\n      	</div>\n\n          <!-- <div class="selectiongroup">		\n              <span class="selection" [ngStyle]="{\'height\': height, \'line-height\': height}" (click)="openBtnClicked()">{{selectionDayTxt}}</span> \n      		<span class="selbtngroup" [style.height]="height">\n                  <button type="button" class="btnclear" *ngIf="selectionDayTxt.length>0" (click)="removeBtnClicked()"><span class="icon icon-cross"></span></button>\n                  <button type="button" class="btnpicker" (click)="openBtnClicked()"><span class="icon icon-calendar"></span></button>\n              </span>		\n          </div>-->\n	\n          <div class="selector" *ngIf="showSelector">\n              <table class="header">\n                  <tr>\n                      <td>\n                          <div style="float:left">\n                              <div class="headerbtn" (click)="prevMonth()"><span class="icon icon-left"></span></div>\n                              <div class="headermonthtxt">{{visibleMonth.monthTxt}}</div>\n                              <div class="headerbtn" (click)="nextMonth()"><span class="icon icon-right"></span></div>\n                          </div>\n                      </td>\n                      <td>\n                          <!-- <button type="button" class="headertodaybtn" (click)="todayClicked()">{{todayBtnTxt}}</button> -->\n                      </td>\n                      <td>\n                          <div style="float:right">\n                              <div class="headerbtn" (click)="prevYear()"><span class="icon icon-left"></span></div>\n                              <div class="headeryeartxt">{{visibleMonth.year}}</div>\n                              <div class="headerbtn" (click)="nextYear()"><span class="icon icon-right"></span></div>\n                          </div>\n                      </td>\n                  </tr>\n              </table>\n              <table class="caltable">\n                  <thead><tr><th *ngFor="#d of weekDays">{{d}}</th></tr></thead>\n                  <tbody>\n                      <tr *ngFor="#w of dates">\n                          <td *ngFor="#d of w"                      [ngClass]="{\'disabled\': d.isOutOfRange, \'prevmonth\':d.cmo===PREV_MONTH,\'currmonth\':d.cmo===CURR_MONTH,\'nextmonth\':d.cmo===NEXT_MONTH, \'currday\':d.currDay, \'selectedday\':selectedDate.day===d.day && selectedDate.month===d.month && selectedDate.year===d.year && d.cmo===CURR_MONTH}" (click)="cellClicked(d)">\n                              <div style="background-color:inherit" [ngClass]="{\'prevmonth\':d.cmo===PREV_MONTH,\'currmonth\':d.cmo===CURR_MONTH,\'nextmonth\':d.cmo===NEXT_MONTH,\'sunday\':d.sun && d.cmo===CURR_MONTH && sunHighlight}">{{d.day}}</div>\n                          </td>\n                      </tr>\n                  </tbody>\n              </table>\n          </div>\n      </div>\n    ',directives:[common_6.NgIf,common_6.NgFor,common_6.NgClass,common_6.NgStyle]}),__metadata("design:paramtypes",[core_19.ElementRef])],MyDatePicker)}(),exports_20("MyDatePicker",MyDatePicker)}}}),System.register("components/trip-add.component",["angular2/core","angular2/common","angular2/router","services/datepicker/mydatepicker","services/trip/trip.service","components/gm-autocomplite.component"],function(exports_21,context_21){"use strict";var core_20,common_7,router_8,mydatepicker_1,trip_service_3,gm_autocomplite_component_2,TripAddComponent;context_21&&context_21.id;return{setters:[function(core_20_1){core_20=core_20_1},function(common_7_1){common_7=common_7_1},function(router_8_1){router_8=router_8_1},function(mydatepicker_1_1){mydatepicker_1=mydatepicker_1_1},function(trip_service_3_1){trip_service_3=trip_service_3_1},function(gm_autocomplite_component_2_1){gm_autocomplite_component_2=gm_autocomplite_component_2_1}],execute:function(){TripAddComponent=function(){function TripAddComponent(_fb,_router,_tripService){this._fb=_fb,this._router=_router,this._tripService=_tripService,this.model={},this.myDatePickerOptions={dateFormat:"dd.mm.yyyy",firstDayOfWeek:"mo",sunHighlight:!0,minDate:new Date},this.selectedDate="",this._busy=!1,this.error="",this.form=_fb.group({from:["",common_7.Validators.required],from_id:["",common_7.Validators.required],to:["",common_7.Validators.required],to_id:["",common_7.Validators.required],when:["",common_7.Validators.required],description:["",common_7.Validators.required]})}return TripAddComponent.prototype.onSubmit=function($from,$to,$when,$description){var _this=this;return this.model.from_id?this.model.to_id?this.model.when?this.model.description?void(this.form.valid&&(this._busy=!0,this.error="",this._tripService.addTrips(this.model).subscribe(function(res){res.trip&&res.trip._id?_this._router.navigate(["Trip",{
id:res.trip._id}]):_this.error="Unexpected error. Try again later.",_this._busy=!1},function(err){_this.error="Unexpected error. Try again later.";try{_this.error=err.json().error||_this.error}catch(e){}_this._busy=!1}))):void $description.focus():void $when.querySelector('input[type="text"]').focus():void $to.querySelector('input[type="text"]').focus():void $from.querySelector('input[type="text"]').focus()},TripAddComponent.prototype.onDateChanged=function(event){this.form.controls.when._touched=!0,this.model.when=1e3*event.epoc},TripAddComponent=__decorate([core_20.Component({template:'\n   <div class="container container-trips-add">\n   	<div class="page-header">\n   		<h2>Add a Trip</h2>\n   	</div>\n\n   	<form class="trips-add-form" method="post" [ngFormModel]="form" (submit)="_busy ? false : onSubmit(from, to, when, description)">\n		\n   		<div class="form-group">\n   			<label>Trip:</label>\n\n   			<div class="form-inline">\n   				<div class="form-group" #from><!--  {{form.controls.from.touched && model.from_id === \'\' ? \'has-error\' : \'\'}} -->\n   					<gm-autocomplite [class]="\'form-control input-lg\'" [name_place]="\'from\'" [name_id]="\'from_id\'" [form]="form" [model]="model" placeholder="From"></gm-autocomplite>\n   				</div>\n				\n   				<div class="arrow-right form-group">\n   					<span class="glyphicon glyphicon-arrow-right"></span>\n   				</div>\n\n   				<div class="form-group" #to>	<!--  {{form.controls.to.touched && model.to_id === \'\' ? \'has-error\' : \'\'}} -->\n   					<gm-autocomplite [class]="\'form-control input-lg\'" [name_place]="\'to\'" [name_id]="\'to_id\'" [form]="form" [model]="model" placeholder="To"></gm-autocomplite>\n   				</div>	\n   			</div>\n   		</div>\n		\n   		<div class="form-group" #when>	\n   			<label>When:</label>\n			\n   			<my-date-picker [options]="myDatePickerOptions" (dateChanged)="onDateChanged($event)" [selDate]="selectedDate" ></my-date-picker>\n			\n   			<input type="hidden" [(ngModel)]="model.when" [ngFormControl]="form.controls.when" />\n   		</div>\n\n   		<div class="form-group">	\n   			<label class="sr-only">Description:</label>\n			\n   			<textarea class="form-control" name="description" [(ngModel)]="model.description" [ngFormControl]="form.controls.description" maxlength="2000" placeholder="Description" #description></textarea>\n   		</div>\n		\n   		<p class="text-right">\n   			<button type="submit" class="btn btn-warning btn-lg">{{ _busy ? \'Wait...\' : \'Add\' }}</button>\n   		</p>\n		\n   		<div *ngIf="error" class="help-block text-right {{error ? \'has-error\' : \'\'}}">\n   			{{ error }}\n   		</div>\n		\n   	</form>\n   </div>\n	',directives:[gm_autocomplite_component_2.GmAutocompliteComponent,common_7.FORM_DIRECTIVES,common_7.CORE_DIRECTIVES,mydatepicker_1.MyDatePicker]}),__metadata("design:paramtypes",[common_7.FormBuilder,router_8.Router,trip_service_3.TripService])],TripAddComponent)}(),exports_21("TripAddComponent",TripAddComponent)}}}),System.register("components/trips-my.component",["angular2/core","angular2/router","services/trip/trip.service","services/notification/notification.service","components/trip-card.component","components/order-card.component","components/goto-card.component","pipes/to-date.pipe"],function(exports_22,context_22){"use strict";var core_21,router_9,trip_service_4,notification_service_2,trip_card_component_3,order_card_component_2,goto_card_component_2,to_date_pipe_7,TripsMyComponent;context_22&&context_22.id;return{setters:[function(core_21_1){core_21=core_21_1},function(router_9_1){router_9=router_9_1},function(trip_service_4_1){trip_service_4=trip_service_4_1},function(notification_service_2_1){notification_service_2=notification_service_2_1},function(trip_card_component_3_1){trip_card_component_3=trip_card_component_3_1},function(order_card_component_2_1){order_card_component_2=order_card_component_2_1},function(goto_card_component_2_1){goto_card_component_2=goto_card_component_2_1},function(to_date_pipe_7_1){to_date_pipe_7=to_date_pipe_7_1}],execute:function(){TripsMyComponent=function(){function TripsMyComponent(_tripService,_notificationService,_appRef,configOrderStatus){var _this=this;this._tripService=_tripService,this._notificationService=_notificationService,this._appRef=_appRef,this.configOrderStatus=configOrderStatus,this.trips=[],this.ordersByTrip={},this.newMessages={},this._inited=!1,this.page=0,this.limit=10,this.fullPage=!1,this._busy=!1,console.log("constructor"),this.loadNext(),this.newMessages=this._notificationService.data.newMessages||{},this._notifSub=this._notificationService.start().subscribe(function(data){_this.newMessages=data.newMessages||{},_this._appRef.tick()})}return TripsMyComponent.prototype.routerOnActivate=function(){return console.log("routerOnActivate"),!1},TripsMyComponent.prototype.loadNext=function(){var _this=this;this._busy=!0,this._tripService.getMy(this.limit,this.page).subscribe(function(res){(res.trips||[]).forEach(function(trip){_this.trips.push(trip)}),(res.orders||[]).forEach(function(order,i,arr){_this.ordersByTrip[order.trip]=_this.ordersByTrip[order.trip]||[],_this.ordersByTrip[order.trip].push(order)}),(res.trips||[])[_this.limit-1]?_this.page++:_this.fullPage=!0,_this._busy=!1,_this._inited=!0},function(error){_this.fullPage=!0,_this._busy=!1,_this._inited=!0})},TripsMyComponent.prototype.ngOnDestroy=function(){this._notifSub.unsubscribe()},TripsMyComponent=__decorate([core_21.Component({template:'\n   <div class="container">\n   	<div class="page-header">\n   		<h2>My Trips</h2>\n   	</div>\n\n   	<p *ngIf="!_inited">Loading...</p>\n\n   	<p *ngIf="_inited && trips && !trips.length">\n   		<i>There are no trips yet. You can <a [routerLink]="[\'TripAdd\']">Add a trip</a>.</i>\n   	</p>\n	\n   <!--(configUser && configUser.id) &&  	<p *ngIf="_inited && !(configUser && configUser.id)">\n   		You are not authorized. <a [routerLink]="[\'Join\']">Create An Account</a> or <a [routerLink]="[\'Login\']">Log in</a> to an existing.\n   	</p> -->\n\n   	<div class="row trips-my" *ngFor="#trip of trips">\n   		<div class="col-lg-4 col-xs-12">\n   			<trip-card [trip]="trip"></trip-card>\n\n   			<p>\n   				{{ trip.description }}\n   			</p>\n   		</div>\n   		<div class="col-lg-8 col-xs-12">\n			\n\n   			<div class="requests-table">\n   				<h5>Requests for shipping:</h5>\n				\n   				<table *ngIf="!ordersByTrip[trip._id]" class="table">\n   					<tr>\n   						<td>\n   							<i>There are no requests yet.</i>\n   						</td>\n   					</tr>\n   				</table>\n				\n   				<table *ngIf="ordersByTrip[trip._id]" class="table">\n   					<tr *ngFor="#order of ordersByTrip[trip._id]">\n   						<td>\n   							<order-card [order]="order" [user]="order.user"></order-card>\n							\n   							<p class="order-message">\n   								{{ order.message }}\n   							</p>\n							\n   							<goto [order]="order" [newMessages]="newMessages"></goto>\n   							<!--\n   							 <p class="text-right">\n   								<span *ngIf="newMessages[order._id] && newMessages[order._id][0]" class="label label-danger">{{newMessages[order._id][0]}} new</span>\n   								<a [routerLink]="[\'Order\', {id:order._id}]">Go to negotiation <span *ngIf="order.msg_cnt">({{ order.msg_cnt }})</span>  <span class="badge" *ngIf="newMessages[order._id] && newMessages[order._id][0]">{{newMessages[order._id][0]}}</span> </a>\n   							</p> -->\n   						</td>\n   					</tr>\n   				</table>\n   			</div>\n   		</div>\n   	</div>\n\n   	<p *ngIf="_inited && !fullPage" class="text-center">\n   		<button class="btn btn-default btn-lg" (click)="_busy ? false : loadNext()">{{ _busy ? \'Wait...\' : \'Load more\' }}</button>\n   	</p>\n   </div>\n	',directives:[router_9.ROUTER_DIRECTIVES,trip_card_component_3.TripCardComponent,order_card_component_2.OrderCardComponent,goto_card_component_2.GotoComponent],pipes:[to_date_pipe_7.ToDatePipe]}),__param(3,core_21.Inject("config.orderStatus")),__metadata("design:paramtypes",[trip_service_4.TripService,notification_service_2.NotificationService,core_21.ApplicationRef,Object])],TripsMyComponent)}(),exports_22("TripsMyComponent",TripsMyComponent)}}}),System.register("components/orders.component",["angular2/core","angular2/router","components/trip-card.component","components/order-card.component","components/goto-card.component","services/order/order.service","services/notification/notification.service","pipes/to-date.pipe"],function(exports_23,context_23){"use strict";var core_22,router_10,trip_card_component_4,order_card_component_3,goto_card_component_3,order_service_4,notification_service_3,to_date_pipe_8,OrdersComponent;context_23&&context_23.id;return{setters:[function(core_22_1){core_22=core_22_1},function(router_10_1){router_10=router_10_1},function(trip_card_component_4_1){trip_card_component_4=trip_card_component_4_1},function(order_card_component_3_1){order_card_component_3=order_card_component_3_1},function(goto_card_component_3_1){goto_card_component_3=goto_card_component_3_1},function(order_service_4_1){order_service_4=order_service_4_1},function(notification_service_3_1){notification_service_3=notification_service_3_1},function(to_date_pipe_8_1){to_date_pipe_8=to_date_pipe_8_1}],execute:function(){OrdersComponent=function(){function OrdersComponent(_orderService,_routeParams,_notificationService,_appRef,configOrderStatus){var _this=this;this._orderService=_orderService,this._routeParams=_routeParams,this._notificationService=_notificationService,this._appRef=_appRef,this.configOrderStatus=configOrderStatus,this.orders=[],this.newMessages={},this._inited=!1,this.page=0,this.limit=15,this.fullPage=!1,this._busy=!1,this.loadNext(),this.newMessages=this._notificationService.data.newMessages||{},this._notifSub=this._notificationService.start().subscribe(function(data){_this.newMessages=data.newMessages||{},_this._appRef.tick()})}return OrdersComponent.prototype.loadNext=function(){var _this=this;this._busy=!0,this._orderService.get(this.limit,this.page).subscribe(function(data){(data.orders||[]).forEach(function(order){_this.orders.push(order)}),(data.orders||[])[_this.limit-1]?_this.page++:_this.fullPage=!0,_this._busy=!1,_this._inited=!0},function(error){_this.fullPage=!0,_this._busy=!1,_this._inited=!0})},OrdersComponent.prototype.ngOnDestroy=function(){this._notifSub.unsubscribe()},OrdersComponent=__decorate([core_22.Component({template:'\n   <div class="container">\n   	<div class="page-header">\n   		<h2>Requests</h2>\n   	</div>\n\n   	<p *ngIf="!_inited">Loading...</p>\n\n   	<p *ngIf="_inited && orders && !orders.length"><i>There are no requests yet.</i></p>\n\n   	<table class="table">\n   		<tr *ngFor="#order of orders; #idx = index">\n   			<td class="col-xs-8">\n   				<order-card [order]="order" [user]="order.user"></order-card>\n				\n   				<p class="order-message">\n   					{{ order.message }}\n   				</p>\n				\n   				<goto [order]="order" [newMessages]="newMessages"></goto>\n   			</td>\n   			<td class="col-xs-4">\n   				<trip-card [trip]="order.trip" [user]="order.trip.user"></trip-card>				\n   			</td>\n   		</tr>\n   	</table>\n\n   	<p *ngIf="_inited && !fullPage" class="text-center">\n   		<button class="btn btn-default btn-lg" (click)="_busy ? false : loadNext()">{{ _busy ? \'Wait...\' : \'Load more\' }}</button>\n   	</p>\n   </div>\n	',directives:[router_10.ROUTER_DIRECTIVES,trip_card_component_4.TripCardComponent,order_card_component_3.OrderCardComponent,goto_card_component_3.GotoComponent],pipes:[to_date_pipe_8.ToDatePipe]}),__param(4,core_22.Inject("config.orderStatus")),__metadata("design:paramtypes",[order_service_4.OrderService,router_10.RouteParams,notification_service_3.NotificationService,core_22.ApplicationRef,Object])],OrdersComponent)}(),exports_23("OrdersComponent",OrdersComponent)}}}),System.register("services/review/review.service",["angular2/core","angular2/http"],function(exports_24,context_24){"use strict";var core_23,http_5,ReviewService;context_24&&context_24.id;return{setters:[function(core_23_1){core_23=core_23_1},function(http_5_1){http_5=http_5_1}],execute:function(){ReviewService=function(){function ReviewService(http){this.http=http}return ReviewService.prototype.add=function(data){var headers=new http_5.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/reviews/add?xhr",JSON.stringify(data),{headers:headers}).map(function(res){return res.json()})},ReviewService.prototype.getByOrderId=function(id){var headers=new http_5.Headers;return headers.append("X-Requested-With","XMLHttpRequest"),this.http.get("/reviews/order/"+id+"?xhr",{headers:headers}).map(function(res){return res.json()})},ReviewService.prototype.get=function(limit,page){var headers=new http_5.Headers;headers.append("X-Requested-With","XMLHttpRequest");var search=new http_5.URLSearchParams;return limit&&search.set("limit",limit),page&&search.set("page",page),this.http.get("/reviews?xhr",{search:search,headers:headers}).map(function(res){return res.json()})},ReviewService.prototype.calculateRating=function(rawRate){var total=(rawRate||[]).reduce(function(res,count,rate){return count=Number(count),count?[res[0]+count,res[1]+count*(rate+1)]:res},[0,0]);return[total[0],total[0]?(total[1]/total[0]).toFixed(1):0]},ReviewService=__decorate([core_23.Injectable(),__metadata("design:paramtypes",[http_5.Http])],ReviewService)}(),exports_24("ReviewService",ReviewService)}}}),System.register("services/invoice/invoice.service",["angular2/core","angular2/http"],function(exports_25,context_25){"use strict";var core_24,http_6,InvoiceService;context_25&&context_25.id;return{setters:[function(core_24_1){core_24=core_24_1},function(http_6_1){http_6=http_6_1}],execute:function(){InvoiceService=function(){function InvoiceService(http,configFees){this.http=http,this.configFees=configFees}return InvoiceService.prototype.add=function(data){var headers=new http_6.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/invoices/add?xhr",JSON.stringify(data),{headers:headers}).map(function(res){return res.json()})},InvoiceService.prototype.pay=function(invoiceId){var headers=new http_6.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/invoices/pay?xhr",JSON.stringify({invoiceId:invoiceId}),{headers:headers}).map(function(res){return res.json()})},InvoiceService.prototype.unhold=function(invoiceId){var headers=new http_6.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/invoices/unhold?xhr",JSON.stringify({invoiceId:invoiceId}),{headers:headers}).map(function(res){return res.json()})},InvoiceService.prototype.refund=function(invoiceId){var headers=new http_6.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/invoices/refund?xhr",JSON.stringify({invoiceId:invoiceId}),{headers:headers}).map(function(res){return res.json()})},InvoiceService.prototype.getByOrderId=function(id){var headers=new http_6.Headers;return headers.append("X-Requested-With","XMLHttpRequest"),this.http.get("/invoices/order/"+id+"?xhr",{headers:headers}).map(function(res){return res.json()})},InvoiceService.prototype.check=function(id){var headers=new http_6.Headers;return headers.append("X-Requested-With","XMLHttpRequest"),this.http.get("/invoices/check/"+id+"?xhr",{headers:headers}).map(function(res){return res.json()})},InvoiceService.prototype.getFees=function(amount,currency){var confPayment=this.configFees,safe=1*(Number(amount)||0).toFixed(2),curConfig=confPayment.cur[currency];if(.01>safe||!curConfig)return!1;var oslikiFix=curConfig.oslikiFix,paypalFix=curConfig.paypalFix,oslikiPr=confPayment.oslikiPr,paypalPr=confPayment.paypalPr,fixes=oslikiFix+paypalFix,p={safe:safe};return p.oslikiFee=oslikiFix+p.safe/100*oslikiPr,p.total=100*(p.safe+paypalFix+p.oslikiFee)/(100-paypalPr),p.paypalFee=1*(paypalFix+p.total/100*paypalPr).toFixed(2),p.oslikiFee=1*p.oslikiFee.toFixed(2),p.total=p.safe+p.oslikiFee+p.paypalFee,p.nonRefundable=fixes+fixes/100*paypalPr,p.refundable=p.total-p.nonRefundable,p.nonRefundableOsliki=oslikiFix,p.nonRefundablePaypal=p.nonRefundable-p.nonRefundableOsliki,Object.keys(p).forEach(function(key){p[key]=p[key].toFixed(2)}),p},InvoiceService=__decorate([core_24.Injectable(),__param(1,core_24.Inject("config.fees")),__metadata("design:paramtypes",[http_6.Http,Object])],InvoiceService)}(),exports_25("InvoiceService",InvoiceService)}}}),System.register("components/review-add.component",["angular2/core","angular2/common","angular2/router","services/review/review.service"],function(exports_26,context_26){"use strict";var core_25,common_8,router_11,review_service_1,ReviewAddComponent;context_26&&context_26.id;return{setters:[function(core_25_1){core_25=core_25_1},function(common_8_1){common_8=common_8_1},function(router_11_1){router_11=router_11_1},function(review_service_1_1){review_service_1=review_service_1_1}],execute:function(){ReviewAddComponent=function(){function ReviewAddComponent(_fb,_reviewService,_location,orderId,onReviewAdd){var _this=this;this._fb=_fb,this._reviewService=_reviewService,this._location=_location,this.orderId=orderId,this.onReviewAdd=onReviewAdd,this.formModel={},this._ratings=[1,2,3,4,5],this.error="",this.form=this._fb.group({order:["",common_8.Validators.required],rating:["",common_8.Validators.required],comment:["",common_8.Validators.required]}),this.formModel.rating=5,this.formModel.order=this.orderId,this._busy=!0,this._reviewService.getByOrderId(this.orderId).subscribe(function(data){data.review&&data.review._id&&(_this.formModel=data.review),_this._busy=!1},function(err){_this._busy=!1}),this._locationSubscribe=this._location.subscribe(function(){_this.closeModal()})}return ReviewAddComponent.prototype.ngOnDestroy=function(){this._locationSubscribe.unsubscribe()},ReviewAddComponent.prototype.closeModal=function(){this._modalComponent&&this._modalComponent.close()},ReviewAddComponent.prototype.onChangeRating=function(el){el.checked&&(this.formModel.rating=el.value)},ReviewAddComponent.prototype.onSubmit=function(elComment){var _this=this;this.form.valid||elComment.focus(),this.form.valid&&!this._busy&&(this._busy=!0,this.error="",this._reviewService.add(this.formModel).subscribe(function(data){_this.closeModal(),_this.onReviewAdd(),_this._busy=!1},function(err){_this.error="Unexpected error. Try again later.";try{_this.error=err.json().error||_this.error}catch(e){}_this._busy=!1}))},ReviewAddComponent=__decorate([core_25.Component({template:'\n   <div (window:keydown)="$event.keyCode == 27 ? closeModal() : true">\n   	<div class="page-header">\n   		<h2>Review on the delivery</h2>\n   	</div>\n\n   	<form action="/reviews/add" method="post" [ngFormModel]="form" (submit)="_busy ? false : onSubmit(comment)">\n   		<input type="hidden" name="order" value="" [(ngModel)]="formModel.order" [ngFormControl]="form.controls.order" />\n   		<!-- http://stackoverflow.com/questions/33986633/angular-2-dependency-injection-error-on-ngfor-in-dynamically-created-component -->\n   		<div class="form-group text-center">\n   			<span *ngFor="#rating of _ratings" class="star-clickable glyphicon glyphicon-star{{ formModel.rating >= rating ? \'\' : \'-empty\' }}" (click)="formModel.rating = rating"></span>\n			\n   			<input type="hidden" name="rating" value="" [(ngModel)]="formModel.rating" [ngFormControl]="form.controls.rating" />\n		\n   			 <!-- <label class="radio-inline">\n   				<input type="radio" name="rating" value="-1" (change)="onChangeRating(rate1)" [checked]="formModel.rating === -1" #rate1 /> <span class="glyphicon glyphicon-thumbs-down"></span> \n   			</label>\n			\n   			<label class="radio-inline">\n   				<input type="radio" name="rating" value="1" (change)="onChangeRating(rate2)" [checked]="formModel.rating === 1" #rate2 /> <span class="glyphicon glyphicon-thumbs-up"></span> \n   			</label>	\n			\n   			<select class="form-control" required [(ngModel)]="formModel.order" [ngFormControl]="form.controls.rating">\n   				<option *ngFor="#r of ratings" [value]="r">{{r}}</option>\n   			</select>-->		\n\n   		</div>\n		\n   		<div class="form-group">		\n   			<textarea class="form-control" name="comment" placeholder="Comment" [(ngModel)]="formModel.comment" [ngFormControl]="form.controls.comment" maxlength="2000" #comment></textarea>\n   		</div>\n		\n   		<p class="text-right">\n   			<button type="button" class="btn btn-default btn-lg" (click)="closeModal()" [disabled]="_busy">Cancel</button>\n   			<button type="submit" class="btn btn-warning btn-lg">{{ _busy ? \'Wait...\' : \'Send\' }}</button><!--  [disabled]="{{ _busy }}" [ngFormControl]="form.controls.rating"-->\n   		</p>\n		\n   		<div *ngIf="error" class="help-block text-right {{error ? \'has-error\' : \'\'}}">\n   			{{ error }}\n   		</div>\n   	</form>\n   </div>\n	',providers:[common_8.FormBuilder]}),__param(3,core_25.Inject("orderId")),__param(4,core_25.Inject("onReviewAdd")),__metadata("design:paramtypes",[common_8.FormBuilder,review_service_1.ReviewService,router_11.Location,String,Function])],ReviewAddComponent)}(),exports_26("ReviewAddComponent",ReviewAddComponent)}}}),System.register("components/invoice-card.component",["angular2/core","services/invoice/invoice.service","pipes/to-date.pipe"],function(exports_27,context_27){"use strict";var core_26,invoice_service_1,to_date_pipe_9,InvoiceCardComponent;context_27&&context_27.id;return{setters:[function(core_26_1){core_26=core_26_1},function(invoice_service_1_1){invoice_service_1=invoice_service_1_1},function(to_date_pipe_9_1){to_date_pipe_9=to_date_pipe_9_1}],execute:function(){InvoiceCardComponent=function(){function InvoiceCardComponent(_invoiceService,configUser,invoiceStatus,sts){this._invoiceService=_invoiceService,this.configUser=configUser,this.invoiceStatus=invoiceStatus,this.sts=sts,this.invoice={},this.error="",this._busy=!1}return InvoiceCardComponent.prototype.ngOnInit=function(){},InvoiceCardComponent.prototype.checkStatus=function($event){var _this=this;$event.preventDefault(),this._busy=!0,this.error="",this._invoiceService.check(this.invoice._id).subscribe(function(data){data&&data.status?_this.invoice.status=data.status:_this.error="Unexpected error. Try again later.",_this._busy=!1},function(err){_this.error="Unexpected error. Try again later.";try{_this.error=err.json().error||_this.error}catch(e){}_this._busy=!1})},InvoiceCardComponent.prototype.ngOnChanges=function(changes){changes.invoice&&(this.fees=this._invoiceService.getFees(this.invoice.amount,this.invoice.currency))},__decorate([core_26.Input(),__metadata("design:type",Object)],InvoiceCardComponent.prototype,"invoice",void 0),InvoiceCardComponent=__decorate([core_26.Component({selector:"invoice-card",template:'\n   <table *ngIf="fees" class="table invoice-table">\n   	<thead>\n   		<tr *ngIf="invoice._id">\n   			<td colspan="2">\n\n   				<small>\n					\n   					Invoice: #{{invoice._id}}\n   				</small>\n				\n   				<small>\n   					<br />\n					\n   					Date: {{ invoice.created_at | toDate | date: \'longDate\' }}\n   				</small>	\n				\n   				<small *ngIf="invoice.dest_id">\n   					<br />\n					\n   					PayPal id: {{ invoice.dest_id }}		\n   				</small>			\n				\n   				<small *ngIf="invoice.comment">\n   					<br />\n					\n   					Comment: {{ invoice.comment }}\n   				</small>\n				\n   				<br />\n					\n   				Status:\n   					<b>\n   						{{ _busy ? \'.........\' : invoiceStatus[invoice.status] }}\n						\n   						<a *ngIf="invoice.status === sts.UNCLEARED" (click)="_busy ? false : checkStatus($event)" href="#">{{ _busy ? \'Wait...\' : \'Check\'}}</a>\n   					</b>\n   					<span *ngIf="error" class="help-block {{ error ? \'has-error\' : \'\' }}" style="display:inline;">({{ error }})</span>\n   			</td>\n   		</tr>\n   	</thead>\n   	<tbody>\n   		<tr>\n   			<td>For the traveler <span *ngIf="invoice._id">"{{ invoice.user.name }}"</span></td>\n   			<td>{{ fees.safe }} {{ invoice.currency }}</td>\n   		</tr>\n		\n   		<tr>\n   			<td>Osliki.Net fee ({{ fees.nonRefundableOsliki }} {{ invoice.currency }} non-refundable)</td>\n   			<td>{{ fees.oslikiFee }} {{ invoice.currency }}</td>\n   		</tr>\n		\n   		<tr>\n   			<td>PayPal fee ({{ fees.nonRefundablePaypal }} {{ invoice.currency }} non-refundable)</td>\n   			<td>{{ fees.paypalFee }} {{ invoice.currency }}</td>\n   		</tr>\n\n   		<tr>\n   			<td><b>Total:</b></td>\n   			<td><b>{{ fees.total }} {{ invoice.currency }}</b></td>\n   		</tr>\n   	</tbody>\n   </table>\n	',pipes:[to_date_pipe_9.ToDatePipe]}),__param(1,core_26.Inject("config.user")),__param(2,core_26.Inject("config.invoiceStatus")),__param(3,core_26.Inject("config.invoiceStatusConst")),__metadata("design:paramtypes",[invoice_service_1.InvoiceService,Object,Object,Object])],InvoiceCardComponent)}(),exports_27("InvoiceCardComponent",InvoiceCardComponent)}}}),System.register("components/invoice-add.component",["angular2/core","angular2/common","angular2/router","components/invoice-card.component","services/invoice/invoice.service"],function(exports_28,context_28){"use strict";var core_27,common_9,router_12,invoice_card_component_1,invoice_service_2,InvoiceAddComponent;context_28&&context_28.id;return{setters:[function(core_27_1){core_27=core_27_1},function(common_9_1){common_9=common_9_1},function(router_12_1){router_12=router_12_1},function(invoice_card_component_1_1){invoice_card_component_1=invoice_card_component_1_1},function(invoice_service_2_1){invoice_service_2=invoice_service_2_1}],execute:function(){InvoiceAddComponent=function(){function InvoiceAddComponent(_fb,_invoiceService,_location,order,onInvoiceAdd,configUser,sts){var _this=this;this._fb=_fb,this._invoiceService=_invoiceService,this._location=_location,this.order=order,this.onInvoiceAdd=onInvoiceAdd,this.configUser=configUser,this.sts=sts,this.invoices=[],this.model={currency:"USD",amount:25,agree:!0},this.error="",this._busy=!1,this._busyInvoice=[],this.errorInvoice=[],this.form=this._fb.group({order:["",common_9.Validators.required],amount:["",function(ctrl){var amount=Number(ctrl.value);return amount||amount&&!(.01>amount)?null:{invalidAmount:!0}}],currency:["",common_9.Validators.required],dest_id:["",function(ctrl){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(ctrl.value)?null:{invalidEmail:!0}}],comment:"",agree:["",function(ctrl){return ctrl.value?null:{invalidAgree:!0}}]}),this.model.order=this.order._id,this.model.dest_id=this.order.trip.user.email,this._loaded=!1,this._invoiceService.getByOrderId(this.order._id).subscribe(function(data){_this.invoices=data&&data.invoices||[];var first=_this.invoices[0];first&&(_this.model.dest_id=first.dest_id,_this.model.amount=first.amount,_this.model.currency=first.currency),_this._loaded=!0},function(err){_this._loaded=!0}),this._locationSubscribe=this._location.subscribe(function(){_this.closeModal()})}return InvoiceAddComponent.prototype.onSubmit=function($dest_id,$amount,$agree){var _this=this;return this.form.controls.dest_id.valid?this.form.controls.amount.valid?this.form.controls.agree.valid?void(this.form.valid&&(this._busy=!0,this.error="",this._invoiceService.add(this.model).subscribe(function(data){_this.closeModal(),_this.onInvoiceAdd(),_this._busy=!1},function(err){_this.error="Unexpected error. Try again later.";try{_this.error=err.json().error||_this.error}catch(e){}_this._busy=!1}))):void $agree.focus():void $amount.focus():void $dest_id.focus()},InvoiceAddComponent.prototype.ngOnDestroy=function(){this._locationSubscribe.unsubscribe()},InvoiceAddComponent.prototype.closeModal=function(){this._modalComponent&&this._modalComponent.close()},InvoiceAddComponent.prototype.onChangeRating=function(el){el.checked&&(this.model.rating=el.value)},InvoiceAddComponent.prototype.payInvoice=function(invoiceId,$agree){var _this=this;return $agree.checked?(this.errorInvoice[invoiceId]="",this._busyInvoice[invoiceId]=!0,void this._invoiceService.pay(invoiceId).subscribe(function(data){data.redirectUrl?window.location=data.redirectUrl:(_this._busyInvoice[invoiceId]=!1,_this.errorInvoice[invoiceId]="Unexpected error. Try again later.")},function(err){_this.errorInvoice[invoiceId]="Unexpected error. Try again later.";try{_this.errorInvoice[invoiceId]=err.json().error||_this.errorInvoice[invoiceId]}catch(e){}_this._busyInvoice[invoiceId]=!1})):void $agree.focus()},InvoiceAddComponent.prototype.invoiceAct=function(act,invoiceId,$agree){var _this=this;return $agree.checked?void(confirm("Are you sure?")&&(this.errorInvoice[invoiceId]="",this._busyInvoice[invoiceId]=!0,this._invoiceService[act](invoiceId).subscribe(function(data){_this.closeModal(),_this.onInvoiceAdd()},function(err){_this.errorInvoice[invoiceId]="Unexpected error. Try again later.";try{_this.errorInvoice[invoiceId]=err.json().error||_this.errorInvoice}catch(e){}_this._busyInvoice[invoiceId]=!1}))):void $agree.focus()},InvoiceAddComponent=__decorate([core_27.Component({template:'\n   <div (window:keydown)="$event.keyCode == 27 ? closeModal() : true">\n   	<div class="page-header">\n   		<h2>Invoices</h2>\n   	</div>\n	\n   	<div *ngIf="!_loaded">\n   		Loading...\n   	</div>\n	\n   	<div *ngIf="_loaded && order.user._id === configUser.id && (!invoices || !invoices.length)">\n   		<i>There are no invoices yet.</i>\n   	</div>\n		\n   	<div class="container container-trips-add">\n		\n   		<div *ngFor="#invoice of invoices">\n   		<br />\n   			<invoice-card [invoice]="invoice"></invoice-card>\n			\n   			<div [ngSwitch]="invoice.status">\n   				<div *ngSwitchWhen="sts.UNPAID" class="text-right">\n   					<div *ngIf="invoice.corr === configUser.id">\n   						<div class="help-block">\n   							<i>When you Unhold, all of the money will be transferred to the traveler PayPal account within one day and we will not be able to refund your money. <br /> When you request a refund, it will take some time to determine whether interests of the traveler are taken into account.</i>\n   						</div>\n						\n   						<div class="checkbox {{ !agree.checked ? \'has-error\' : \'\' }}">					\n   							<label>\n   								<input type="checkbox" [disabled]="_busyInvoice[invoice._id]" checked #agree /> I understand and agree with the above.						\n   							</label>\n   						</div>\n						\n   						<button type="button" class="btn btn-warning" (click)="_busyInvoice[invoice._id] ? false : payInvoice(invoice._id, agree)">{{ _busyInvoice[invoice._id] ? \'Wait...\' : \'Pay\' }}</button>\n						\n   						<div *ngIf="errorInvoice[invoice._id]" class="help-block text-right {{errorInvoice[invoice._id] ? \'has-error\' : \'\'}}">\n   							{{ errorInvoice[invoice._id] }}\n   						</div>\n						\n   						<br />\n   					</div>\n   				</div>\n				\n   				<div *ngSwitchWhen="sts.PAID" class="text-right">\n   					<div *ngIf="invoice.corr === configUser.id">\n   						<div class="help-block">\n   							<i>When you Unhold, all of the money will be transferred to the traveler PayPal account and we will not be able to refund your money. <br /> When you request a refund, it will take some time to determine whether interests of the traveler are taken into account.</i>\n   						</div>\n						\n   						<div class="checkbox {{ !agree.checked ? \'has-error\' : \'\' }}">					\n   							<label>\n   								<input type="checkbox" [disabled]="_busyInvoice[invoice._id]" checked #agree /> I understand and agree with the above.						\n   							</label>\n   						</div>					\n					\n   						<button type="button" class="btn btn-warning" (click)="_busyInvoice[invoice._id] ? false : invoiceAct(\'unhold\', invoice._id, agree)">{{ _busyInvoice[invoice._id] ? \'Wait........\' : \'Unhold money\' }}</button>\n						\n   						<button type="button" class="btn btn-warning" (click)="_busyInvoice[invoice._id] ? false : invoiceAct(\'refund\', invoice._id, agree)">{{ _busyInvoice[invoice._id] ? \'Wait..\' : \'Refund\' }}</button>\n						\n   						<div *ngIf="errorInvoice[invoice._id]" class="help-block text-right {{errorInvoice[invoice._id] ? \'has-error\' : \'\'}}">\n   							{{ errorInvoice[invoice._id] }}\n   						</div>\n						\n   						<br />\n   					</div>\n   				</div>\n   			</div>		\n   		</div>\n\n   		<br />\n\n   		<div *ngIf="order.user._id !== configUser.id">\n   			<hr />\n			\n   			<h3>New invoice</h3>\n			\n   			<br />\n			\n   			<form action="/invoices/add" method="post" [ngFormModel]="form" (submit)="_busy ? false : onSubmit(dest_id, amount, agree)" novalidate>\n   				<input type="hidden" name="order" value="" [(ngModel)]="model.order" [ngFormControl]="form.controls.order" />\n				\n   				<div class="form-group {{form.controls.dest_id.touched && !form.controls.dest_id.valid ? \'has-error\' : \'\'}}">	\n   					<label>Your PayPal id:</label>\n					\n   					<input class="form-control input-lg" type="email" name="email" [(ngModel)]="model.dest_id" [ngFormControl]="form.controls.dest_id" placeholder="E-mail" #dest_id />\n					\n   					<p *ngIf="form.controls.dest_id.touched && form.controls.dest_id.errors && form.controls.dest_id.errors.invalidEmail" class="help-block">\n   						E-mail is not valid.\n   					</p>\n   				</div>	\n				\n   				<div class="form-group {{form.controls.amount.touched && !form.controls.amount.valid ? \'has-error\' : \'\'}}">	\n   					<label>Amount:</label>\n					\n   					<div class="form-group form-inline">						\n   						<input class="form-control input-lg" name="amount" type="number" min="0.01" step="5" placeholder="25.00" [(ngModel)]="model.amount" [ngFormControl]="form.controls.amount" #amount />\n						\n   						<select class="form-control input-lg" name="currency" [(ngModel)]="model.currency" [ngFormControl]="form.controls.currency" (change)="model.currency=select.value" #select>\n   							<option value="USD">USD</option>\n   							<option value="EUR">EUR</option>\n   							<option value="CAD">CAD</option>\n   							<option value="RUB">RUB</option>\n   						</select>\n   					</div>\n					\n   					<p *ngIf="form.controls.amount.touched && form.controls.amount.errors && form.controls.amount.errors.invalidAmount" class="help-block">\n   						Amount should be valid number and more than "0.01"\n   					</p>\n   				</div>\n				\n   				<div class="form-group">\n   					<label>Comment:</label>\n					\n   					<input class="form-control input-lg" name="comment" [(ngModel)]="model.comment" [ngFormControl]="form.controls.comment" maxlength="2000" placeholder="Comment" />\n   				</div>\n				\n   				<br />\n				\n   				<div class="form-group help-block text-right">\n   					<invoice-card [invoice]="{amount: model.amount, currency: model.currency}">{{model.amount}}</invoice-card>\n   					<i>All of the money will be placed on the account of our service.</i>\n   				</div>\n				\n   				<div class="checkbox text-right {{ !form.controls.agree.valid ? \'has-error\' : \'\' }}">					\n   					<label>\n   						<input type="checkbox" [(ngModel)]="model.agree" [ngFormControl]="form.controls.agree" #agree /> I understand and agree with the above.						\n   					</label>\n   				</div>\n					\n   				<p class="text-right">\n   					<button type="button" class="btn btn-default btn-lg" (click)="closeModal()" [disabled]="_busy">Cancel</button>\n   					<button type="submit" class="btn btn-warning btn-lg">{{ _busy ? \'Wait...\' : \'Send\' }}</button>\n   				</p>\n				\n   				<div *ngIf="error" class="help-block text-right {{error ? \'has-error\' : \'\'}}">\n   					{{ error }}\n   				</div>\n   			</form>\n   			<br />\n   			<br />\n   		</div>\n		\n   	</div>\n   </div>\n	',
providers:[common_9.FormBuilder],directives:[invoice_card_component_1.InvoiceCardComponent]}),__param(3,core_27.Inject("order")),__param(4,core_27.Inject("onInvoiceAdd")),__param(5,core_27.Inject("config.user")),__param(6,core_27.Inject("config.invoiceStatusConst")),__metadata("design:paramtypes",[common_9.FormBuilder,invoice_service_2.InvoiceService,router_12.Location,Object,Function,Object,Object])],InvoiceAddComponent)}(),exports_28("InvoiceAddComponent",InvoiceAddComponent)}}}),System.register("services/message/message.service",["angular2/core","angular2/http"],function(exports_29,context_29){"use strict";var core_28,http_7,MessageService;context_29&&context_29.id;return{setters:[function(core_28_1){core_28=core_28_1},function(http_7_1){http_7=http_7_1}],execute:function(){MessageService=function(){function MessageService(http){this.http=http}return MessageService.prototype.getDialogs=function(){var headers=new http_7.Headers;return headers.append("X-Requested-With","XMLHttpRequest"),this.http.get("/messages?xhr",{headers:headers}).map(function(res){return res.json()})},MessageService.prototype.getAll=function(orderId,corrId){var headers=new http_7.Headers;return headers.append("X-Requested-With","XMLHttpRequest"),this.http.get("/messages/"+(orderId?"order/"+orderId:"user/"+corrId)+"?xhr",{headers:headers}).map(function(res){return res.json()})},MessageService.prototype.getLastMessages=function(lastId,orderId,corrId){var headers=new http_7.Headers;return headers.append("X-Requested-With","XMLHttpRequest"),this.http.get("/messages/last/"+lastId+"/"+(orderId?"order/"+orderId:"user/"+corrId)+"?xhr",{headers:headers}).map(function(res){return res.json()})},MessageService.prototype.add=function(data){var headers=new http_7.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/messages/add?xhr",JSON.stringify(data),{headers:headers}).map(function(res){return res.json().message})},MessageService=__decorate([core_28.Injectable(),__metadata("design:paramtypes",[http_7.Http])],MessageService)}(),exports_29("MessageService",MessageService)}}}),System.register("components/chat.component",["angular2/core","angular2/router","angular2/common","services/message/message.service","services/notification/notification.service","pipes/to-date.pipe"],function(exports_30,context_30){"use strict";var core_29,router_13,common_10,message_service_1,notification_service_4,to_date_pipe_10,ChatComponent;context_30&&context_30.id;return{setters:[function(core_29_1){core_29=core_29_1},function(router_13_1){router_13=router_13_1},function(common_10_1){common_10=common_10_1},function(message_service_1_1){message_service_1=message_service_1_1},function(notification_service_4_1){notification_service_4=notification_service_4_1},function(to_date_pipe_10_1){to_date_pipe_10=to_date_pipe_10_1}],execute:function(){ChatComponent=function(){function ChatComponent(_messageService,_notificationService,_fb,_el,_appRef,configUser){this._messageService=_messageService,this._notificationService=_notificationService,this._fb=_fb,this._el=_el,this._appRef=_appRef,this.configUser=configUser,this.isChatActual=!1,this.isChatActualChange=new core_29.EventEmitter,this.userOutput=new core_29.EventEmitter,this.orderOutput=new core_29.EventEmitter,this.orderStatusOutput=new core_29.EventEmitter,this.errorOutput=new core_29.EventEmitter,this.messages=[],this.lastId="0",this.formModel={},this._chatHeight=0,this._inited=!1,this._busy=!1,this.form=_fb.group({message:["",common_10.Validators.required]})}return ChatComponent.prototype.ngOnInit=function(){var _this=this;this.elChatList=this._el.nativeElement.querySelector(".chat-list"),this._notifSub=this._notificationService.start(3e3).subscribe(function(data){(_this.orderId&&data.newMessages&&data.newMessages[_this.orderId]&&(data.newMessages[_this.orderId][0]||data.newMessages[_this.orderId][1]!==_this.lastId)||_this.corrId&&data.newPrivMessages&&data.newPrivMessages[_this.corrId]&&(data.newPrivMessages[_this.corrId][0]||data.newPrivMessages[_this.corrId][1]!==_this.lastId))&&_this.getLastMessages()}),this.orderId?(this.form.controls.order=new common_10.Control("order",common_10.Validators.required),this.formModel.order=this.orderId):this.corrId&&(this.form.controls.corr=new common_10.Control("corr",common_10.Validators.required),this.formModel.corr=this.corrId),this.getMessages()},ChatComponent.prototype.ngOnChanges=function(changes){!changes.isChatActual||changes.isChatActual.currentValue||changes.isChatActual.isFirstChange()||this.getLastMessages()},ChatComponent.prototype.ngOnDestroy=function(){this._notifSub&&(this._notificationService.changeTimeout(),this._notifSub.unsubscribe())},ChatComponent.prototype.ngAfterViewChecked=function(){var listTop=Math.round(this.elChatList.getBoundingClientRect().top+(window.document.documentElement.scrollTop||window.document.body.scrollTop));this._listTop!==listTop&&(this._listTop=listTop,this.expand(listTop)),this._chatHeight!==this.elChatList.scrollHeight&&(this._chatHeight=this.elChatList.scrollHeight,this.scrollDown())},ChatComponent.prototype.scrollDown=function(){this.elChatList.scrollTop=this.elChatList.scrollHeight},ChatComponent.prototype.expand=function(listTop){var windowHeight=window.innerHeight||window.document.document.documentElement.clientHeight||window.document.documentElement.clientHeight;listTop=listTop||this.elChatList.getBoundingClientRect().top+(window.document.documentElement.scrollTop||window.document.body.scrollTop);var height=windowHeight-listTop-160;this.elChatList.style.maxHeight=(200>height?200:height)+"px"},ChatComponent.prototype.onResize=function(){this.expand()},ChatComponent.prototype.getMessages=function(){var _this=this;this._messageService.getAll(this.orderId,this.corrId).subscribe(function(res){res.messages&&res.messages.length&&(_this.messages=res.messages,_this.lastId=res.messages[res.messages.length-1]._id),_this.orderId?_this.orderOutput.emit(res.order||{}):_this.userOutput.emit(res.user||{}),_this.isChatActual=!0,_this.isChatActualChange.emit(_this.isChatActual),_this._inited=!0},function(err){_this.errorOutput.emit(err)})},ChatComponent.prototype.getLastMessages=function(){var _this=this;this._inited&&this._messageService.getLastMessages(this.lastId,this.orderId,this.corrId).subscribe(function(res){res.messages&&res.messages.length&&(_this.lastId=res.messages[res.messages.length-1]._id,res.messages.forEach(function(message){return _this.messages.push(message)})),_this.orderId&&res.order&&_this.orderStatusOutput.emit(res.order.status),_this.isChatActual=!0,_this.isChatActualChange.emit(_this.isChatActual),_this._appRef.tick()},function(err){})},ChatComponent.prototype.onSubmit=function(elComment){var _this=this;this.form.valid||elComment.focus(),this.form.valid&&(this._busy=!0,this._messageService.add(this.formModel).subscribe(function(message){_this._busy=!1,_this.formModel.message="",_this.getLastMessages()},function(err){_this._busy=!1}))},__decorate([core_29.Input(),__metadata("design:type",String)],ChatComponent.prototype,"orderId",void 0),__decorate([core_29.Input(),__metadata("design:type",String)],ChatComponent.prototype,"corrId",void 0),__decorate([core_29.Input(),__metadata("design:type",Boolean)],ChatComponent.prototype,"isChatActual",void 0),__decorate([core_29.Output(),__metadata("design:type",core_29.EventEmitter)],ChatComponent.prototype,"isChatActualChange",void 0),__decorate([core_29.Output("user"),__metadata("design:type",core_29.EventEmitter)],ChatComponent.prototype,"userOutput",void 0),__decorate([core_29.Output("order"),__metadata("design:type",core_29.EventEmitter)],ChatComponent.prototype,"orderOutput",void 0),__decorate([core_29.Output("orderStatus"),__metadata("design:type",core_29.EventEmitter)],ChatComponent.prototype,"orderStatusOutput",void 0),__decorate([core_29.Output("error"),__metadata("design:type",core_29.EventEmitter)],ChatComponent.prototype,"errorOutput",void 0),ChatComponent=__decorate([core_29.Component({selector:"chat",template:'\n   <div class="chat-list" (window:resize)="expand()">	\n   	<table *ngFor="#message of messages; #idx = index;" class="table {{ message.user._id === configUser.id ? \'chat-message-my\' : \'\' }}">\n   		<tr>\n   			<td class="chat-avatar avatar">\n   				<img src="http://gravatar.com/avatar/{{ message.user.gravatar_hash }}?d=monsterid&s=40" alt="{{ message.user.name }}" width="40px" height="40px" />\n   			</td>\n   			<td>\n   				<div class="chat-message-info">\n   					<b>{{ message.user.name }}</b>\n   					<small>\n   						<small class="text-muted">{{ message.created_at | toDate | date: \'mm:HH d MMM y\' }}</small>\n   					</small>\n   				</div>\n\n   				<p class="pre-wrap">{{ message.message }}</p>\n   			</td>\n   		</tr>\n   	</table>\n   </div>\n\n   <div *ngIf="_inited" class="chat-textarea">\n   	<form action="/messages/add" method="post" [ngFormModel]="form" (submit)="_busy ? false : onSubmit(elComment)"> <!--  -->\n   		<input *ngIf="orderId" name="order" type="hidden" [(ngModel)]="formModel.order" [ngFormControl]="form.controls.order" />\n   		<input *ngIf="corrId" name="corr" type="hidden" [(ngModel)]="formModel.corr" [ngFormControl]="form.controls.corr" />\n		\n   		<div class="form-group">			\n   			<textarea class="form-control" name="message" [(ngModel)]="formModel.message" [ngFormControl]="form.controls.message" placeholder="Message" maxlength="1000" #elComment></textarea>\n   		</div>\n		\n   		<p class="text-right">\n   			<button type="submit" class="btn btn-warning btn-lg">{{ _busy ? \'Wait...\' : \'Send\' }}</button>\n   		</p>\n   	</form>\n   </div>\n	',pipes:[to_date_pipe_10.ToDatePipe],directives:[router_13.ROUTER_DIRECTIVES]}),__param(5,core_29.Inject("config.user")),__metadata("design:paramtypes",[message_service_1.MessageService,notification_service_4.NotificationService,common_10.FormBuilder,core_29.ElementRef,core_29.ApplicationRef,Object])],ChatComponent)}(),exports_30("ChatComponent",ChatComponent)}}}),System.register("components/order.component",["angular2/core","angular2/router","services/order/order.service","services/modal/modal.service","services/review/review.service","services/invoice/invoice.service","pipes/to-date.pipe","components/trip-card.component","components/order-card.component","components/review-add.component","components/invoice-add.component","components/chat.component"],function(exports_31,context_31){"use strict";var core_30,router_14,order_service_5,modal_service_3,review_service_2,invoice_service_3,to_date_pipe_11,trip_card_component_5,order_card_component_4,review_add_component_1,invoice_add_component_1,chat_component_1,OrderComponent;context_31&&context_31.id;return{setters:[function(core_30_1){core_30=core_30_1},function(router_14_1){router_14=router_14_1},function(order_service_5_1){order_service_5=order_service_5_1},function(modal_service_3_1){modal_service_3=modal_service_3_1},function(review_service_2_1){review_service_2=review_service_2_1},function(invoice_service_3_1){invoice_service_3=invoice_service_3_1},function(to_date_pipe_11_1){to_date_pipe_11=to_date_pipe_11_1},function(trip_card_component_5_1){trip_card_component_5=trip_card_component_5_1},function(order_card_component_4_1){order_card_component_4=order_card_component_4_1},function(review_add_component_1_1){review_add_component_1=review_add_component_1_1},function(invoice_add_component_1_1){invoice_add_component_1=invoice_add_component_1_1},function(chat_component_1_1){chat_component_1=chat_component_1_1}],execute:function(){OrderComponent=function(){function OrderComponent(_orderService,_modalService,_reviewService,_invoiceService,_routeParams,_appRef,configOrderStatus,sts,configUser){this._orderService=_orderService,this._modalService=_modalService,this._reviewService=_reviewService,this._invoiceService=_invoiceService,this._routeParams=_routeParams,this._appRef=_appRef,this.configOrderStatus=configOrderStatus,this.sts=sts,this.configUser=configUser,this.isChatActual=!1,this.isTripPassed=!1,this.order={},this.error="",this._changeStatusBusy=!1,this._loaded=!1,this.orderId=this._routeParams.get("id")}return OrderComponent.prototype.changeStatus=function(status){var _this=this;this._changeStatusBusy||(this._changeStatusBusy=!0,this._orderService.changeStatus(status,this.orderId).subscribe(function(data){_this.isChatActual=!1,_this._changeStatusBusy=!1},function(err){_this._changeStatusBusy=!1}))},OrderComponent.prototype.invoices=function(){var _this=this;this._modalService.show(invoice_add_component_1.InvoiceAddComponent,core_30.Injector.resolve([core_30.provide(invoice_service_3.InvoiceService,{useValue:this._invoiceService}),core_30.provide("order",{useValue:this.order}),core_30.provide("config.user",{useValue:this.configUser}),core_30.provide("onInvoiceAdd",{useValue:function(){_this.isChatActual=!1}})]))},OrderComponent.prototype.sendReview=function(){var _this=this;this._modalService.show(review_add_component_1.ReviewAddComponent,core_30.Injector.resolve([core_30.provide(review_service_2.ReviewService,{useValue:this._reviewService}),core_30.provide("orderId",{useValue:this.orderId}),core_30.provide("onReviewAdd",{useValue:function(){_this.isChatActual=!1}})]))},OrderComponent.prototype.onOrder=function(order){if(this._loaded=!0,this.order=order,this.order&&this.order.trip){var now=(new Date).getTime()-864e5;this.isTripPassed=new Date(this.order.trip.when)<now}},OrderComponent.prototype.onChatError=function(err){if(this._loaded=!0,!err)return void(this.error="");this.error="Unexpected error. Try again later.";try{this.error=err.json().error||this.error}catch(e){}},OrderComponent.prototype.onOrderStatus=function(status){this.order.status=status,this._appRef.tick()},OrderComponent=__decorate([core_30.Component({selector:"order",template:'\n   <div class="container" (window:keydown)="$event.keyCode == 27 ? closeModal() : true">\n	\n   	<div class="page-header">\n   		<h2>Request</h2>		\n   	</div>\n		\n   	<!-- <div *ngIf="!error && (!order || !order.trip)">Loading...</div> -->\n   	<div *ngIf="!_loaded">Loading...</div>\n	\n   	<div *ngIf="error"><i>{{ error }}</i></div>\n\n   	<div *ngIf="order && order.trip" class="row">\n   		<div class="col-xs-6">\n   			<order-card [order]="order" [user]="order.user"></order-card>\n   		</div>\n   		<div class="col-xs-6">\n   			<trip-card [trip]="order.trip" [user]="order.trip.user"></trip-card>\n   		</div>\n   		<div class="col-xs-12">\n   			<p class="order-message pre-wrap">{{ order.message }}</p>\n			\n   			<div *ngIf="configUser.id === order.user._id" [ngSwitch]="order.status" class="text-center">\n   				<p>\n   					<span *ngSwitchWhen="sts.NEGOTIATION">\n   						<button class="btn btn-default" (click)="changeStatus(sts.CANCELLED)">Cancel request</button>\n   					</span>\n					\n   					<span *ngSwitchWhen="sts.PROCESSING">\n   						<button *ngIf="isTripPassed" class="btn btn-warning" (click)="changeStatus(sts.FINISHED)">Finish</button>\n   					</span>\n					\n   					<span *ngSwitchWhen="sts.CANCELLED">\n   						<button *ngIf="!isTripPassed" class="btn btn-warning" (click)="changeStatus(sts.NEGOTIATION)">Restore</button>\n   					</span>\n					\n   					<span *ngIf="order.status === sts.PROCESSING || order.status === sts.FINISHED">\n   						<button *ngIf="order && order._id" class="btn btn-warning" (click)="invoices()">Invoices</button>\n   						<button *ngIf="isTripPassed" class="btn btn-warning" (click)="sendReview()">Leave feedback</button>						\n   					</span>\n   				</p>\n   			</div>\n			\n   			<div *ngIf="configUser.id === order.trip.user._id" [ngSwitch]="order.status" class="text-center">\n   				<p>\n   					<span *ngSwitchWhen="sts.NEGOTIATION">\n   						<button *ngIf="!isTripPassed" class="btn btn-warning" (click)="changeStatus(sts.PROCESSING)">Accept</button> \n   						<button class="btn btn-default" (click)="changeStatus(sts.REFUSED)">Refuse</button>\n   					</span>\n   					<span *ngSwitchWhen="sts.PROCESSING">\n   						<button *ngIf="isTripPassed" class="btn btn-warning" (click)="changeStatus(sts.FINISHED)">Finish</button>\n   					</span>\n   					<span *ngSwitchWhen="sts.REFUSED">\n   						<button *ngIf="!isTripPassed" class="btn btn-warning" (click)="changeStatus(sts.NEGOTIATION)">Restore</button>\n   					</span>\n   					<span *ngIf="order.status === sts.PROCESSING || order.status === sts.FINISHED">\n   						<button *ngIf="order && order._id" class="btn btn-warning" (click)="invoices()">Invoices</button>\n   						<button *ngIf="isTripPassed" class="btn btn-warning" (click)="sendReview()">Leave feedback</button>\n   					</span>\n   				</p>\n   			</div>\n   		</div>\n   	</div>\n\n   	<!-- (orderStatus)="onOrderStatus($event)"  -->\n   	<chat [hidden]="!order || !order.trip" (order)="onOrder($event)" (orderStatus)="onOrderStatus($event)" (error)="onChatError($event)" [(isChatActual)]="isChatActual" [orderId]="orderId"></chat>\n\n   </div>\n	',pipes:[to_date_pipe_11.ToDatePipe],directives:[router_14.ROUTER_DIRECTIVES,trip_card_component_5.TripCardComponent,order_card_component_4.OrderCardComponent,chat_component_1.ChatComponent]}),__param(6,core_30.Inject("config.orderStatus")),__param(7,core_30.Inject("config.orderStatusConst")),__param(8,core_30.Inject("config.user")),__metadata("design:paramtypes",[order_service_5.OrderService,modal_service_3.ModalService,review_service_2.ReviewService,invoice_service_3.InvoiceService,router_14.RouteParams,core_30.ApplicationRef,Object,Object,Object])],OrderComponent)}(),exports_31("OrderComponent",OrderComponent)}}}),System.register("services/user/user.service",["angular2/core","angular2/http"],function(exports_32,context_32){"use strict";var core_31,http_8,UserService;context_32&&context_32.id;return{setters:[function(core_31_1){core_31=core_31_1},function(http_8_1){http_8=http_8_1}],execute:function(){UserService=function(){function UserService(http){this.http=http}return UserService.prototype.getById=function(id){var headers=new http_8.Headers;return headers.append("X-Requested-With","XMLHttpRequest"),this.http.get("/users/"+(id||"my")+"?xhr",{headers:headers}).map(function(res){return res.json()})},UserService.prototype.update=function(data){var headers=new http_8.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/users/update?xhr",JSON.stringify(data),{headers:headers}).map(function(res){return res.json()})},UserService.prototype.login=function(data){var headers=new http_8.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/users/login?xhr",JSON.stringify(data),{headers:headers}).map(function(res){return res.json()})},UserService.prototype.signup=function(data){var headers=new http_8.Headers;return headers.append("Content-Type","application/json"),headers.append("X-Requested-With","XMLHttpRequest"),this.http.post("/users/signup?xhr",JSON.stringify(data),{headers:headers}).map(function(res){return res.json()})},UserService=__decorate([core_31.Injectable(),__metadata("design:paramtypes",[http_8.Http])],UserService)}(),exports_32("UserService",UserService)}}}),System.register("components/user.component",["angular2/core","angular2/common","angular2/router","services/user/user.service","services/review/review.service","components/user-card.component","pipes/to-date.pipe"],function(exports_33,context_33){"use strict";var core_32,common_11,router_15,user_service_1,review_service_3,user_card_component_3,to_date_pipe_12,UserComponent;context_33&&context_33.id;return{setters:[function(core_32_1){core_32=core_32_1},function(common_11_1){common_11=common_11_1},function(router_15_1){router_15=router_15_1},function(user_service_1_1){user_service_1=user_service_1_1},function(review_service_3_1){review_service_3=review_service_3_1},function(user_card_component_3_1){user_card_component_3=user_card_component_3_1},function(to_date_pipe_12_1){to_date_pipe_12=to_date_pipe_12_1}],execute:function(){UserComponent=function(){function UserComponent(_fb,_userService,_reviewService,_routeParams,configUser){var _this=this;this._fb=_fb,this._userService=_userService,this._reviewService=_reviewService,this._routeParams=_routeParams,this.configUser=configUser,this.uid="",this.adminUid="5702b5d213e381b973f9a9f8",this.user={},this.reviews=[],this.formModel={},this._ratings=[1,2,3,4,5],this.tRating=[0,0],this.rRating=[0,0],this._inited=!1,this._busy=!1,this.editMode=!1,this.page=0,this.limit=15,this.fullPage=!1,this._busyPaging=!1,this.uid=this._routeParams.get("id")||"",this.form=this._fb.group({about:""}),this._userService.getById(this.uid).subscribe(function(res){_this.user=res.user||{},_this.user&&(_this.formModel.about=_this.user.about||""),_this.user&&_this.user.stats&&(_this.tRating=_this._reviewService.calculateRating(_this.user.stats.t_rate),_this.rRating=_this._reviewService.calculateRating(_this.user.stats.r_rate))},function(error){}),this.loadNext()}return UserComponent.prototype.onSubmit=function(){var _this=this;this.form.valid&&!this._busy&&(this._busy=!0,this._userService.update(this.formModel).subscribe(function(data){data.user&&(_this.user.about=data.user.about),_this._busy=!1,_this.editMode=!1},function(err){_this._busy=!1,_this.editMode=!1}))},UserComponent.prototype.loadNext=function(){var _this=this;this._busyPaging=!0,this._reviewService.get(this.limit,this.page).subscribe(function(data){(data.reviews||[]).forEach(function(review){_this.reviews.push(review)}),(data.reviews||[])[_this.limit-1]?_this.page++:_this.fullPage=!0,_this._busyPaging=!1,_this._inited=!0},function(error){_this._busyPaging=!1,_this._inited=!0})},UserComponent=__decorate([core_32.Component({template:'\n\n   <div *ngIf="!(configUser && configUser.id)" class="container">\n   	<div class="page-header">\n   		<h2>User profile</h2>\n   	</div>\n	\n   	<p>\n   		You are not authorized. <a [routerLink]="[\'Join\']">Create An Account</a> or <a [routerLink]="[\'Login\']">Log in</a> to an existing.\n   	</p>	\n   </div>\n	\n   <div *ngIf="(configUser && configUser.id)" class="container">\n   	<div class="page-header">\n   		<h2 *ngIf="user && user._id">Profile of <span>{{ user.name }}</span></h2>\n   	</div>\n	\n   	<p *ngIf="!_inited">Loading...</p>\n   	<p *ngIf="_inited && !(user && user._id)"><i>User not found.</i></p>\n\n   	<div *ngIf="user && user._id" class="row">\n   		<div class="col-sm-3 col-xs-12">	\n   			<p>\n   				<img src="http://gravatar.com/avatar/{{ user.gravatar_hash }}?d=monsterid&s=200" alt="{{ user.name }}" width="100%" />\n   			</p>\n   			<p *ngIf="user._id !== adminUid">\n   				<span class="text-muted">Joined: {{ user.created_at | toDate | date: \'longDate\' }}</span>\n   			</p>\n   			<p *ngIf="configUser.id === user._id">\n   				<a href="https://gravatar.com" target="_blank">Change Gravatar</a>\n   			</p>\n			\n   			<p *ngIf="configUser.id !== user._id">\n   				<span class="glyphicon glyphicon-envelope"></span>\n   				<a [routerLink]="[\'Messages\', {id: user._id}]"> Send a message</a>\n   			</p>\n			\n   			<p *ngIf="configUser.id === user._id">\n   				<span class="glyphicon glyphicon-envelope"></span>\n   				<a [routerLink]="[\'Dialogs\']"> My Dialogs</a>\n   			</p>\n\n   		</div>\n   		<div class="col-sm-9 col-xs-12">\n\n   			<div *ngIf="user.stats && user._id !== adminUid">\n   				<h4>Statistic:</h4>\n\n   				<table class="table">\n   					<tr>\n   						<th colspan="2">As a traveler:</th>\n   					</tr>\n   					<tr>\n   						<td>Trips</td>\n   						<td>{{ user.stats.t_cnt }}</td>\n   					</tr>\n   					<tr>\n   						<td>Requests on delivery</td>\n   						<td>{{ user.stats.t_order }}</td>\n   					</tr>\n   					<tr>\n   						<td>Processed requests</td>\n   						<td>{{ user.stats.t_proc }}</td>\n   					</tr>\n   					<tr>\n   						<td>Rating</td>\n   						<td>\n   							 {{tRating[1]}} <span class="star glyphicon glyphicon-star"></span> <small>from {{tRating[0]}} rates</small>\n   						</td>\n   					</tr>\n\n   					<tr>\n   						<th colspan="2">As a customer:</th>\n   					</tr>\n   					<tr>\n   						<td>Requests on delivery</td>\n   						<td>{{ user.stats.r_cnt }}</td>\n   					</tr>\n   					<tr>\n   						<td>Processed requests</td>\n   						<td>{{ user.stats.r_proc }}</td>\n   					</tr>\n   					<tr>\n   						<td>Rating</td>\n   						<td>\n   							{{rRating[1]}} <span class="star glyphicon glyphicon-star"></span> <small>from {{rRating[0]}} rates</small>\n   						</td>\n   					</tr>\n   				</table>\n   			</div>\n   		</div>\n		\n   		<div class="col-xs-12">\n   			<h3 *ngIf="user && user._id && (user.about || configUser.id === user._id)">About {{ user._id === adminUid ? \'us\' : \'me\' }}</h3>\n			\n   			<p *ngIf="!editMode" class="pre-wrap">{{ user.about }}</p>\n			\n   			<form *ngIf="editMode" action="/users/edit" method="post" [ngFormModel]="form" (submit)="onSubmit()">\n   				<div class="form-group">				\n   					<textarea class="form-control" name="about" [(ngModel)]="formModel.about" [ngFormControl]="form.controls.about"  maxlength="2000" placeholder="About me"></textarea>\n   				</div>\n				\n   				<p class="text-right">\n   					<button class="btn btn-warning btn-lg" type="submit" [disabled]="_busy">{{ _busy ? \'Wait...\' : \'Update\' }}</button>\n   					<button class="btn btn-default btn-lg" type="submit" (click)="editMode = false" [disabled]="_busy">Cancel</button>\n   				</p>\n   			</form>\n			\n   			<p *ngIf="!editMode && configUser.id === user._id" class="text-right">\n   				<button class="btn btn-default btn-lg" (click)="editMode = true">Edit</button>\n   			</p>\n			\n   			<div *ngIf="user._id !== adminUid">\n   				<h3>Reviews</h3>\n				\n   				<p *ngIf="reviews && !reviews.length">There are no reviews yet.</p>\n				\n   				<!-- <div class="row" *ngFor="#review of reviews">\n   					<div class="col-xs-12">\n					\n\n						\n   					</div>\n   				</div> -->\n				\n   				<table class="table">\n   					<tr *ngFor="#review of reviews">\n   						<td>\n   							<span *ngFor="#rating of _ratings" class="star glyphicon glyphicon-star{{ review.rating >= rating ? \'\' : \'-empty\' }}"></span>\n							\n   							<p>\n   								<user-card [user]="review.user"></user-card>\n								\n   								<strong *ngIf="user._id === review.user._id"> ({{ review.isUserTripper ? \'traveler\' : \'customer\' }}) </strong>\n								\n   								about \n								 \n   								<user-card [user]="review.corr"></user-card>\n								\n   								<strong *ngIf="user._id === review.corr._id"> ({{ review.isUserTripper ? \'traveler\' : \'customer\' }}) </strong>						\n   							</p>\n							\n							\n   							<span class="text-muted">{{ review.created_at | toDate | date: \'longDate\' }}</span>			\n\n   							<p class="pre-wrap">{{ review.comment }}</p>\n							\n   							<p *ngIf="configUser.id === user._id">\n   								<a [routerLink]="[\'Order\', {id: review.order}]"> Go to the order</a>\n   							</p>\n   						</td>\n   					</tr>\n   				</table>\n				\n   				<p *ngIf="_inited && !fullPage" class="text-center">\n   					<button class="btn btn-default btn-lg" (click)="_busyPaging ? false : loadNext()">{{ _busyPaging ? \'Wait...\' : \'Load more\' }}</button>\n   				</p>\n   			</div>\n   		</div>\n   	</div>\n   </div>\n	',directives:[router_15.ROUTER_DIRECTIVES,user_card_component_3.UserCardComponent],pipes:[to_date_pipe_12.ToDatePipe]}),__param(4,core_32.Inject("config.user")),__metadata("design:paramtypes",[common_11.FormBuilder,user_service_1.UserService,review_service_3.ReviewService,router_15.RouteParams,Object])],UserComponent)}(),exports_33("UserComponent",UserComponent)}}}),System.register("components/notifications.component",["angular2/core","angular2/router","pipes/to-date.pipe","services/notification/notification.service"],function(exports_34,context_34){"use strict";var core_33,router_16,to_date_pipe_13,notification_service_5,NotificationsComponent;context_34&&context_34.id;return{setters:[function(core_33_1){core_33=core_33_1},function(router_16_1){router_16=router_16_1},function(to_date_pipe_13_1){to_date_pipe_13=to_date_pipe_13_1},function(notification_service_5_1){notification_service_5=notification_service_5_1}],execute:function(){NotificationsComponent=function(){function NotificationsComponent(_notificationService,_appRef){var _this=this;this._notificationService=_notificationService,this._appRef=_appRef,this.newOrders=[],this.newTrips=[],this.newMessagesKeys=[],this.newPrivMessagesKeys=[],this.isOpened=!1,this._notificationService.start().subscribe(function(data){console.log("NotificationsComponent subscribe"),console.dir(data),_this.newOrders=data.newOrders,_this.newTrips=data.newTrips,_this.newMessages=data.newMessages,_this.newMessagesKeys=_this.getKeys(data.newMessages),_this.newPrivMessages=data.newPrivMessages,_this.newPrivMessagesKeys=_this.getKeys(data.newPrivMessages),console.log("this.newPrivMessagesKeys",_this.newPrivMessagesKeys),_this._appRef.tick()},function(err){})}return NotificationsComponent.prototype.onClick=function($event){return this.isOpened=!this.isOpened,$event.stopPropagation(),!1},NotificationsComponent.prototype.onDocumentClick=function($event){this.isOpened=!1},NotificationsComponent.prototype.getKeys=function(obj){return obj?Object.keys(obj).filter(function(key){return obj[key][0]}):[]},NotificationsComponent=__decorate([core_33.Component({selector:"[notifications]",template:'\n   <a *ngIf="newTrips.length || newOrders.length || newMessagesKeys.length || newPrivMessagesKeys.length" href="" (click)="onClick($event)" (document:click)="onDocumentClick($event)"><strong class="glyphicon glyphicon-bell"></strong></a>\n\n   <div *ngIf="isOpened && (newTrips.length || newOrders.length || newMessagesKeys.length || newPrivMessagesKeys.length)" class="popover-my"><!--  (click)="$event.stopPropagation()" -->\n   	<ul class="notifications-list">\n   		<li *ngFor="#order of newOrders">\n   			<a [routerLink]="[\'Order\', {id: order}]">New order</a>\n   		</li>\n   		<li *ngFor="#trip of newTrips">\n   			<a [routerLink]="[\'Trip\', {id: trip}]">New trip</a>\n   		</li>\n   		<li *ngFor="#order of newMessagesKeys">\n   			<a [routerLink]="[\'Order\', {id: order}]">{{ newMessages[order][0] }} new message{{ newMessages[order] > 1 ? \'s\' : \'\' }}</a>\n   		</li>\n   		<li *ngFor="#corr of newPrivMessagesKeys">\n   			<a [routerLink]="[\'Messages\', {id: corr}]">{{ newPrivMessages[corr][0] }} new private message{{ newPrivMessages[corr] > 1 ? \'s\' : \'\' }}</a>\n   		</li>\n   	</ul>\n   	<div class="clearfix"></div>\n   </div>\n	',directives:[router_16.ROUTER_DIRECTIVES],pipes:[to_date_pipe_13.ToDatePipe]}),__metadata("design:paramtypes",[notification_service_5.NotificationService,core_33.ApplicationRef])],NotificationsComponent)}(),exports_34("NotificationsComponent",NotificationsComponent)}}}),System.register("components/messages.component",["angular2/core","angular2/router","pipes/to-date.pipe","components/user-card.component","components/chat.component"],function(exports_35,context_35){"use strict";var core_34,router_17,to_date_pipe_14,user_card_component_4,chat_component_2,MessagesComponent;context_35&&context_35.id;return{setters:[function(core_34_1){core_34=core_34_1},function(router_17_1){router_17=router_17_1},function(to_date_pipe_14_1){to_date_pipe_14=to_date_pipe_14_1},function(user_card_component_4_1){user_card_component_4=user_card_component_4_1},function(chat_component_2_1){chat_component_2=chat_component_2_1}],execute:function(){MessagesComponent=function(){function MessagesComponent(_routeParams,configUser){this._routeParams=_routeParams,this.configUser=configUser,this.isChatActual=!1,this.user={},this.error="",this._loaded=!1,this.corrId=this._routeParams.get("id")}return MessagesComponent.prototype.onUser=function(user){this._loaded=!0,this.user=user;
},MessagesComponent.prototype.onChatError=function(err){this._loaded=!0,this.error="Unexpected error. Try again later.";try{this.error=err.json().error||this.error}catch(e){}},MessagesComponent=__decorate([core_34.Component({selector:"messages",template:'\n   <div class="container">\n   	<div class="page-header">\n   		<h2>\n   			Dialog\n			\n   			<span *ngIf="user && user._id">\n   				with \n   				<user-card [user]="user"></user-card>\n   			</span>\n   		</h2>		\n   	</div>\n\n   	<div *ngIf="!_loaded">Loading...</div>\n	\n   	<div *ngIf="error"><i>{{ error }}</i></div>	\n	\n   	<chat (user)="onUser($event)" (error)="onChatError($event)" [(isChatActual)]="isChatActual" [corrId]="corrId"></chat>\n   </div>\n	',pipes:[to_date_pipe_14.ToDatePipe],directives:[router_17.ROUTER_DIRECTIVES,chat_component_2.ChatComponent,user_card_component_4.UserCardComponent]}),__param(1,core_34.Inject("config.user")),__metadata("design:paramtypes",[router_17.RouteParams,Object])],MessagesComponent)}(),exports_35("MessagesComponent",MessagesComponent)}}}),System.register("components/dialogs.component",["angular2/core","angular2/router","services/message/message.service","services/notification/notification.service","components/user-card.component","pipes/to-date.pipe"],function(exports_36,context_36){"use strict";var core_35,router_18,message_service_2,notification_service_6,user_card_component_5,to_date_pipe_15,DialogsComponent;context_36&&context_36.id;return{setters:[function(core_35_1){core_35=core_35_1},function(router_18_1){router_18=router_18_1},function(message_service_2_1){message_service_2=message_service_2_1},function(notification_service_6_1){notification_service_6=notification_service_6_1},function(user_card_component_5_1){user_card_component_5=user_card_component_5_1},function(to_date_pipe_15_1){to_date_pipe_15=to_date_pipe_15_1}],execute:function(){DialogsComponent=function(){function DialogsComponent(_messageService,_notificationService,_appRef,configUser){var _this=this;this._messageService=_messageService,this._notificationService=_notificationService,this._appRef=_appRef,this.configUser=configUser,this._loaded=!1,this._messageService.getDialogs().subscribe(function(res){_this.dialogs=res.dialogs||[],_this._loaded=!0},function(error){_this._loaded=!0}),this.newPrivMessages=this._notificationService.data.newPrivMessages||{},this._notifSub=this._notificationService.start().subscribe(function(data){_this.newPrivMessages=data.newPrivMessages||{},_this._appRef.tick()})}return DialogsComponent.prototype.ngOnDestroy=function(){this._notifSub.unsubscribe()},DialogsComponent=__decorate([core_35.Component({template:'\n   <div class="container">\n   	<div class="page-header">\n   		<h2>Dialogs</h2>\n   	</div>\n\n   	<div *ngIf="!_loaded">Loading...</div>\n	\n   	<p *ngIf="dialogs && !dialogs.length"><i>No dialogs</i></p>\n\n   	<table class="table">\n   		<tr *ngFor="#dialog of dialogs">\n   			<td>\n   				<user-card *ngIf="dialog.corr && dialog.corr._id" [user]="dialog.corr"></user-card>\n				\n				\n				\n   				<p>\n   					<small class="text-muted">{{ dialog.lastMsgCreatedAt | toDate | date: \'mm:HH d MMM y\' }}</small>\n   					<br />\n   					{{ dialog.lastMsg.message.length > 200 ? dialog.lastMsg.message.substring(0, 200) + \'...\' :  dialog.lastMsg.message }}\n   				</p>\n				\n   				<p class="text-right">\n   					<a [routerLink]="[\'Messages\', {id: dialog.corr._id}]">\n   						Go to the dialog \n   						<span class="badge" *ngIf="newPrivMessages[dialog.corr._id] && newPrivMessages[dialog.corr._id][0]">\n   							{{newPrivMessages[dialog.corr._id][0]}}\n   						</span>\n   					</a>\n   				</p>	\n   			</td>\n   		</tr>\n   	</table>\n   </div>\n	',directives:[router_18.ROUTER_DIRECTIVES,user_card_component_5.UserCardComponent],pipes:[to_date_pipe_15.ToDatePipe]}),__param(3,core_35.Inject("config.user")),__metadata("design:paramtypes",[message_service_2.MessageService,notification_service_6.NotificationService,core_35.ApplicationRef,Object])],DialogsComponent)}(),exports_36("DialogsComponent",DialogsComponent)}}}),System.register("components/login.component",["angular2/core","angular2/common","angular2/router","services/user/user.service"],function(exports_37,context_37){"use strict";var core_36,common_12,router_19,user_service_2,LoginComponent;context_37&&context_37.id;return{setters:[function(core_36_1){core_36=core_36_1},function(common_12_1){common_12=common_12_1},function(router_19_1){router_19=router_19_1},function(user_service_2_1){user_service_2=user_service_2_1}],execute:function(){LoginComponent=function(){function LoginComponent(_fb,_userService){this._fb=_fb,this._userService=_userService,this.model={},this._busy=!1,this.success=!1,this.error="",this.form=_fb.group({email:["",common_12.Validators.compose([function(ctrl){return/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(ctrl.value)?null:{invalidEmail:!0}},common_12.Validators.required])]})}return LoginComponent.prototype.onSubmit=function($email){var _this=this;this.form.valid?(this._busy=!0,this.error="",this._userService.login(this.model).subscribe(function(res){_this.success=!0,_this._busy=!1},function(err){_this.error="Unexpected error. Try again later.";try{_this.error=err.json().error||_this.error}catch(e){}_this._busy=!1})):$email.focus()},LoginComponent=__decorate([core_36.Component({selector:"login",template:'\n   <div class="container container-join">\n   	<div class="page-header">\n   		<h2>Log in</h2>\n   	</div>\n	\n   	<p *ngIf="success">\n   		<i>A link to access has been sent to your email address. Please check your email inbox.</i>\n   	</p>\n\n   	<form *ngIf="!success" method="post" [ngFormModel]="form" (submit)="_busy ? false : onSubmit(email)" novalidate>\n   		<div class="form-group">\n   			<label class="sr-only">E-mail</label>\n   			<input class="form-control input-lg email" type="email" name="email" [(ngModel)]="model.email" [ngFormControl]="form.controls.email" placeholder="E-mail" #email />\n   		</div>\n   		<div class="help-block text-right">\n   			Don\'t have an account? - <a [routerLink]="[\'Join\']">Sign up »</a>\n   		</div>	\n		\n   		<div class="form-group text-right">\n   			<button type="submit" class="btn btn-warning btn-lg">{{ _busy ? \'Wait..\' : \'Log in\' }}</button>\n   		</div>\n		\n   		<div *ngIf="error" class="help-block text-right {{error ? \'has-error\' : \'\'}}">\n   			{{ error }}\n   		</div>\n\n   	</form>\n   </div>\n	',directives:[router_19.ROUTER_DIRECTIVES],pipes:[]}),__metadata("design:paramtypes",[common_12.FormBuilder,user_service_2.UserService])],LoginComponent)}(),exports_37("LoginComponent",LoginComponent)}}}),System.register("components/join.component",["angular2/core","angular2/common","angular2/router","components/captcha.component","services/user/user.service"],function(exports_38,context_38){"use strict";var core_37,common_13,router_20,captcha_component_2,user_service_3,JoinComponent;context_38&&context_38.id;return{setters:[function(core_37_1){core_37=core_37_1},function(common_13_1){common_13=common_13_1},function(router_20_1){router_20=router_20_1},function(captcha_component_2_1){captcha_component_2=captcha_component_2_1},function(user_service_3_1){user_service_3=user_service_3_1}],execute:function(){JoinComponent=function(){function JoinComponent(_fb,_userService){this._fb=_fb,this._userService=_userService,this.model={},this._busy=!1,this.needReloadCaptcha=!1,this.submitted=!1,this.success=!1,this.error="",this.form=_fb.group({name:["",common_13.Validators.compose([function(ctrl){return ctrl.value&&""===ctrl.value.replace(/^\s\s*/,"").replace(/\s\s*$/,"")?{emptyName:!0}:null},common_13.Validators.required,function(ctrl){return ctrl.value&&!/^[a-z0-9-_ \.]+$/i.test(ctrl.value)?{invalidName:!0}:null}])],email:["",common_13.Validators.compose([common_13.Validators.required,function(ctrl){return ctrl.value&&!/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i.test(ctrl.value)?{invalidEmail:!0}:null}])],recaptcha:["",common_13.Validators.required]})}return JoinComponent.prototype.onSubmit=function($name,$email){var _this=this;return this.submitted=!0,this.form.controls.name.valid?this.form.controls.email.valid?void(this.form.valid&&(this._busy=!0,this.error="",this._userService.signup(this.model).subscribe(function(res){_this.success=!0,_this._busy=!1},function(err){console.log(_this.needReloadCaptcha),_this.error="Unexpected error. Try again later.",_this.needReloadCaptcha=!0;try{_this.error=err.json().error||_this.error}catch(e){}_this._busy=!1}))):void $email.focus():void $name.focus()},JoinComponent=__decorate([core_37.Component({selector:"join",template:'\n   <div class="container container-join">\n   	<div class="page-header">\n   		<h2>Sign up</h2>\n   	</div>\n	\n   	<p *ngIf="success">\n   		<i>A link to access has been sent to your email address. Please check your email inbox.</i>\n   	</p>\n\n   	<form *ngIf="!success" method="post" [ngFormModel]="form" (submit)="_busy ? false : onSubmit(name, email)" novalidate>\n   		<div class="form-group {{form.controls.name.touched && !form.controls.name.valid ? \'has-error\' : \'\'}}">\n   			<label class="sr-only">Name</label>\n			\n   			<input class="form-control input-lg" type="text" name="name" [(ngModel)]="model.name" [ngFormControl]="form.controls.name" placeholder="Name (latin letters only)" maxlength="50" #name />\n			\n   			<p *ngIf="form.controls.name.errors && form.controls.name.errors.invalidName" class="help-block">\n   				Latin letters only.\n   			</p>\n			\n   			<p *ngIf="form.controls.name.errors && form.controls.name.errors.emptyName" class="help-block">\n   				Empty name\n   			</p>\n			\n   		</div>\n\n   		<div class="form-group {{form.controls.email.touched && !form.controls.email.valid ? \'has-error\' : \'\'}}">\n   			<label class="sr-only">E-mail</label>\n\n   			<input class="form-control input-lg" type="email" name="email" [(ngModel)]="model.email" [ngFormControl]="form.controls.email" placeholder="E-mail" #email />\n			\n   			<p *ngIf="form.controls.email.touched && form.controls.email.errors && form.controls.email.errors.invalidEmail" class="help-block">\n   				E-mail is not valid.\n   			</p>\n   		</div>\n		\n   		<div class="form-group text-right {{submitted && model.recaptcha === \'\' ? \'has-error\' : \'\'}}">\n   			<captcha [ctrl]="form.controls.recaptcha" [(model)]="model.recaptcha" [(needReloadCaptcha)]="needReloadCaptcha"></captcha>\n   		</div>\n   		<div class="help-block text-right">\n   			Already have an account? - <a [routerLink]="[\'Login\']">Log in »</a>\n   		</div>		\n   		<div class="form-group text-right">\n   			<button type="submit" class="btn btn-warning btn-lg">{{ _busy ? \'Wait..\' : \'Sign up\' }}</button>\n   		</div>\n		\n   		<div *ngIf="error" class="help-block text-right {{error ? \'has-error\' : \'\'}}">\n   			{{ error }}\n   		</div>\n		\n   	</form>\n   </div>\n	',directives:[router_20.ROUTER_DIRECTIVES,captcha_component_2.CaptchaComponent],pipes:[]}),__metadata("design:paramtypes",[common_13.FormBuilder,user_service_3.UserService])],JoinComponent)}(),exports_38("JoinComponent",JoinComponent)}}}),System.register("components/app",["angular2/core","angular2/router","angular2/http","angular2/common","components/trip.component","components/trips.component","components/trip-add.component","components/trips-my.component","components/orders.component","components/order.component","components/user.component","components/notifications.component","components/messages.component","components/dialogs.component","components/login.component","components/join.component","components/user-card.component","services/trip/trip.service","services/order/order.service","services/modal/modal.service","services/message/message.service","services/review/review.service","services/invoice/invoice.service","services/user/user.service","services/notification/notification.service","services/subscribe/subscribe.service"],function(exports_39,context_39){"use strict";var core_38,router_21,http_9,common_14,trip_component_1,trips_component_1,trip_add_component_1,trips_my_component_1,orders_component_1,order_component_1,user_component_1,notifications_component_1,messages_component_1,dialogs_component_1,login_component_1,join_component_1,user_card_component_6,trip_service_5,order_service_6,modal_service_4,message_service_3,review_service_4,invoice_service_4,user_service_4,notification_service_7,subscribe_service_3,AppComponent;context_39&&context_39.id;return{setters:[function(core_38_1){core_38=core_38_1},function(router_21_1){router_21=router_21_1},function(http_9_1){http_9=http_9_1},function(common_14_1){common_14=common_14_1},function(trip_component_1_1){trip_component_1=trip_component_1_1},function(trips_component_1_1){trips_component_1=trips_component_1_1},function(trip_add_component_1_1){trip_add_component_1=trip_add_component_1_1},function(trips_my_component_1_1){trips_my_component_1=trips_my_component_1_1},function(orders_component_1_1){orders_component_1=orders_component_1_1},function(order_component_1_1){order_component_1=order_component_1_1},function(user_component_1_1){user_component_1=user_component_1_1},function(notifications_component_1_1){notifications_component_1=notifications_component_1_1},function(messages_component_1_1){messages_component_1=messages_component_1_1},function(dialogs_component_1_1){dialogs_component_1=dialogs_component_1_1},function(login_component_1_1){login_component_1=login_component_1_1},function(join_component_1_1){join_component_1=join_component_1_1},function(user_card_component_6_1){user_card_component_6=user_card_component_6_1},function(trip_service_5_1){trip_service_5=trip_service_5_1},function(order_service_6_1){order_service_6=order_service_6_1},function(modal_service_4_1){modal_service_4=modal_service_4_1},function(message_service_3_1){message_service_3=message_service_3_1},function(review_service_4_1){review_service_4=review_service_4_1},function(invoice_service_4_1){invoice_service_4=invoice_service_4_1},function(user_service_4_1){user_service_4=user_service_4_1},function(notification_service_7_1){notification_service_7=notification_service_7_1},function(subscribe_service_3_1){subscribe_service_3=subscribe_service_3_1}],execute:function(){AppComponent=function(){function AppComponent(_location,configUser){var _this=this;this._location=_location,this.configUser=configUser,this.adminUid="5702b5d213e381b973f9a9f8",this._location.subscribe(function(){_this.isVisible=!1})}return AppComponent=__decorate([core_38.Component({selector:"app",template:'\n   <!-- <button (click)="openModal()">open test modal</button> -->\n   <div class="container-fluid head" (document:click)="isVisible = false; true;">\n   	<nav class="navbar navbar-default">\n   		<button class="btn btn-default navbar-toggle" type="button" (click)="isVisible = !isVisible; $event.stopPropagation()">\n   			<span class="glyphicon glyphicon-menu-hamburger"> </span> \n   		</button>	\n	\n   		<div class="navbar-header">\n   			<a class="navbar-brand" [routerLink]="[\'Main\']">Osliki.Net <sup>β</sup></a>\n   		</div>\n\n   		<ul class="nav navbar-nav navbar-right">\n   			<li *ngIf="configUser && configUser.id" class="notifications" notifications></li>\n   			<li *ngIf="!configUser || !configUser.id" class="navbar-right">\n   				<button class="btn btn-warning join" [routerLink]="[\'Join\']">Join</button>\n   			</li>\n   			<li *ngIf="!configUser || !configUser.id">\n   				<a [routerLink]="[\'Login\']">Log in</a>\n   			</li>\n   			<li *ngIf="configUser && configUser.id">\n   				<user-card [user]="configUser"></user-card>\n   			</li>\n   			<li *ngIf="configUser && configUser.id" class="navbar-invtoggle">\n   				<a href="/users/logout"><span class="glyphicon glyphicon-log-out"></span></a>\n   			</li>\n   		</ul>\n\n   		<ul class="nav navbar-nav navbar-invtoggle">\n   			<li><a [routerLink]="[\'Trips\']">Find Trips</a></li>\n   			<li *ngIf="configUser && configUser.id"><a [routerLink]="[\'TripAdd\']">Add a Trip</a></li> \n   			<li *ngIf="!configUser || !configUser.id"><a [routerLink]="[\'Join\']">Add a Trip</a></li> \n   			<li *ngIf="configUser && configUser.id"><a [routerLink]="[\'TripsMy\']">My Trips</a></li>\n   			<li *ngIf="configUser && configUser.id"><a [routerLink]="[\'Orders\']">Requests</a></li>\n   			<li *ngIf="configUser && configUser.id"><a [routerLink]="[\'Messages\', {id: adminUid}]">Help</a></li>\n   		</ul>\n   	</nav>\n   </div>\n\n   <ul class="nav navbar-nav navbar-invtoggle toggle-menu {{isVisible ? \'menu-opened\' : \'\'}}" (click)="isVisible = !isVisible">\n   	<li><a [routerLink]="[\'Trips\']">Find Trips</a></li>\n   	<li *ngIf="configUser && configUser.id"><a [routerLink]="[\'TripAdd\']">Add a Trip</a></li> \n   	<li *ngIf="!configUser || !configUser.id"><a [routerLink]="[\'Join\']">Add a Trip</a></li> \n   	<li *ngIf="configUser && configUser.id"><a [routerLink]="[\'TripsMy\']">My Trips</a></li>\n   	<li *ngIf="configUser && configUser.id"><a [routerLink]="[\'Orders\']">Requests</a></li>\n   	<li *ngIf="configUser && configUser.id"><a [routerLink]="[\'Messages\', {id: adminUid}]">Help</a></li>\n   	<li *ngIf="configUser && configUser.id">\n   		<a href="/users/logout" (click)="$event.stopPropagation()"><span class="glyphicon glyphicon-log-out"></span> Log out</a>\n   	</li>\n   </ul>\n\n   <router-outlet></router-outlet>\n	',directives:[router_21.ROUTER_DIRECTIVES,common_14.FORM_DIRECTIVES,common_14.CORE_DIRECTIVES,notifications_component_1.NotificationsComponent,user_card_component_6.UserCardComponent],providers:[http_9.HTTP_PROVIDERS,common_14.FORM_PROVIDERS,trip_service_5.TripService,order_service_6.OrderService,modal_service_4.ModalService,message_service_3.MessageService,notification_service_7.NotificationService,user_service_4.UserService,review_service_4.ReviewService,invoice_service_4.InvoiceService,subscribe_service_3.SubscribeService]}),router_21.RouteConfig([{path:"/",name:"Main",component:trips_component_1.TripsComponent,data:{isMain:!0}},{path:"/trips",name:"Trips",component:trips_component_1.TripsComponent},{path:"/trips/:id",name:"Trip",component:trip_component_1.TripComponent},{path:"/trips/add",name:"TripAdd",component:trip_add_component_1.TripAddComponent},{path:"/trips/my",name:"TripsMy",component:trips_my_component_1.TripsMyComponent},{path:"/users/:id",name:"User",component:user_component_1.UserComponent},{path:"/users/me",name:"UserMe",component:user_component_1.UserComponent},{path:"/users/login",name:"Login",component:login_component_1.LoginComponent},{path:"/users/join",name:"Join",component:join_component_1.JoinComponent},{path:"/orders",name:"Orders",component:orders_component_1.OrdersComponent},{path:"/messages/order/:id",name:"Order",component:order_component_1.OrderComponent},{path:"/messages/user/:id",name:"Messages",component:messages_component_1.MessagesComponent},{path:"/messages",name:"Dialogs",component:dialogs_component_1.DialogsComponent}]),__param(1,core_38.Inject("config.user")),__metadata("design:paramtypes",[router_21.Location,Object])],AppComponent)}(),exports_39("AppComponent",AppComponent)}}}),System.register("boot",["components/app","angular2/platform/browser","angular2/router","angular2/core","angular2/http","rxjs/Rx","services/maps-api-loader/lazy-maps-api-loader"],function(exports_40,context_40){"use strict";var app_1,browser_1,router_22,core_39,http_10,lazy_maps_api_loader_2;context_40&&context_40.id;return{setters:[function(app_1_1){app_1=app_1_1},function(browser_1_1){browser_1=browser_1_1},function(router_22_1){router_22=router_22_1},function(core_39_1){core_39=core_39_1},function(http_10_1){http_10=http_10_1},function(_1){},function(lazy_maps_api_loader_2_1){lazy_maps_api_loader_2=lazy_maps_api_loader_2_1}],execute:function(){core_39.enableProdMode(),browser_1.bootstrap(app_1.AppComponent,[router_22.ROUTER_PROVIDERS,core_39.provide(router_22.APP_BASE_HREF,{useValue:"/"}),http_10.Http,core_39.provide(lazy_maps_api_loader_2.LazyMapsAPILoaderConfig,{useFactory:function(){return window.googleMaps}}),core_39.provide("config.user",{useFactory:function(){return window.user}}),core_39.provide("config.captcha",{useFactory:function(){return window.googleRecaptcha}}),core_39.provide("config.orderStatus",{useFactory:function(){return window.orderStatus}}),core_39.provide("config.orderStatusConst",{useFactory:function(){return window.orderStatusConst}}),core_39.provide("config.invoiceStatus",{useFactory:function(){return window.invoiceStatus}}),core_39.provide("config.invoiceStatusConst",{useFactory:function(){return window.invoiceStatusConst}}),core_39.provide("config.fees",{useFactory:function(){return window.fees}}),lazy_maps_api_loader_2.LazyMapsAPILoader])}}}),System.register("services/datepicker/sampleapp",["angular2/platform/browser","angular2/core","services/datepicker/mydatepicker"],function(exports_41,context_41){"use strict";var browser_2,core_40,mydatepicker_2,SampleDatePicker;context_41&&context_41.id;return{setters:[function(browser_2_1){browser_2=browser_2_1},function(core_40_1){core_40=core_40_1},function(mydatepicker_2_1){mydatepicker_2=mydatepicker_2_1}],execute:function(){SampleDatePicker=function(){function SampleDatePicker(){this.myDatePickerOptions={todayBtnTxt:"Today",dateFormat:"dd.mm.yyyy",firstDayOfWeek:"mo",sunHighlight:!0,height:"34px",width:"260px"},this.selectedDate="20.12.2015"}return SampleDatePicker.prototype.ngOnInit=function(){console.log("onInit(): SampleDatePicker")},SampleDatePicker.prototype.onDateChanged=function(event){console.log("onDateChanged(): ",event.date," - formatted: ",event.formatted," - epoc timestamp: ",event.epoc)},SampleDatePicker=__decorate([core_40.Component({selector:"sample-date-picker",template:'<my-date-picker [options]="myDatePickerOptions" (dateChanged)="onDateChanged($event)" [selDate]="selectedDate"></my-date-picker>',directives:[mydatepicker_2.MyDatePicker]}),__metadata("design:paramtypes",[])],SampleDatePicker)}(),browser_2.bootstrap(SampleDatePicker)}}});
//# sourceMappingURL=app.js.map
